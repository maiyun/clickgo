var emodule=function(t){"use strict";function e(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(a){if("default"!==a){var i=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,i.get?i:{enumerable:!0,get:function(){return t[a]}})}}),e.default=t,Object.freeze(e)}var a=e(t);class i extends a.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={go:null,went:null},this.props={modelValue:"",plain:!1,map:null},this.mapSelected="",this.loading=!1,this.loaded={},this.access={nav:null},this.activeId=""}async hideActive(){if(!this.activeId)return;a.form.removeActivePanel(this,this.activeId,this.formId),await this.loaded[this.activeId].vroot.onHide();this.element.querySelector('[data-panel-id="'+this.activeId.toString()+'"]').style.display="none"}async go(t,e={},i={}){if(this.loading)return!1;const o={detail:{data:e,nav:i.nav??!1,action:i.action??"forword",previous:i.previous??"",qsChange:!1}},s={detail:{action:i.action??"forword",data:e,nav:i.nav??!1,previous:i.previous??"",qsChange:!1}};this.loading=!0,"string"==typeof t&&(t=a.tool.urlResolve(this.path+"/",t));for(const e in this.loaded){const i=this.loaded[e];if(i.obj!==t)continue;if(this.activeId.toString()===e)return this.access.nav&&(i.vroot.qs=a.tool.clone(this.access.nav.qs),await i.vroot.onQsChange(),s.detail.qsChange=!0,await i.vroot.onQsChangeShow(s)),this.loading=!1,!0;await this.hideActive(),this.activeId=e,a.form.setActivePanel(this,this.formId,this.activeId);return this.element.querySelector('[data-panel-id="'+e+'"]').style.display="flex",this.access.nav&&JSON.stringify(i.vroot.qs)!==JSON.stringify(this.access.nav.qs)&&(i.vroot.qs=a.tool.clone(this.access.nav.qs),await i.vroot.onQsChange(),s.detail.qsChange=!0,o.detail.qsChange=!0),await i.vroot.onShow(o),await i.vroot.onQsChangeShow(s),this.loading=!1,!0}try{const e=await a.form.createPanel(this,t);await this.hideActive(),this.activeId=e.id,a.form.setActivePanel(this,this.formId,this.activeId),this.loaded[e.id]={obj:t,vapp:e.vapp,vroot:e.vroot};return this.element.querySelector('[data-panel-id="'+e.id.toString()+'"]').style.display="flex",this.access.nav&&(e.vroot.qs=a.tool.clone(this.access.nav.qs),await e.vroot.onQsChange(),o.detail.qsChange=!0),await e.vroot.onShow(o),await e.vroot.onQsChangeShow(s),this.loading=!1,!0}catch{return this.loading=!1,!1}}send(t){this.activeId&&this.loaded[this.activeId].vroot.onReceive(t)}async mapNameChange(t={}){if(!this.props.map)return void(this.mapSelected="");const e=this.access.nav?this.access.nav.selected:this.props.modelValue;if(e===this.mapSelected)return;const a=this.mapSelected.split("?"),i=e.split("?"),o={go:!0,preventDefault:function(){this.go=!1},detail:{from:a[0],to:i[0]}};if(this.emit("go",o),!o.go)return;const s={detail:{result:await this.go(this.props.map[i[0]],this.rootForm.formHashData,{nav:!!this.access.nav,action:t.action??"forword",previous:t.previous??""}),from:o.detail.from,to:o.detail.to}};this.emit("went",s),s.detail.result&&(this.mapSelected=e,await this.loaded[this.activeId].vroot.onShowed())}onMounted(){this.access.nav=this.parentByName("nav"),this.rootForm.ready(async()=>{this.watch("modelValue",async()=>{await this.mapNameChange()}),this.watch("map",async()=>{await this.mapNameChange()},{deep:!0}),this.access.nav&&this.watch(()=>{const t=a.tool.clone(this.rootForm._historyHash);return this.rootForm.formHash&&t.push(this.rootForm.formHash),t},async(t,e)=>{const a=t.length<e.length?"back":"forword";await this.mapNameChange({action:a,previous:e[e.length-1]})},{deep:!0}),await this.mapNameChange()})}onBeforeUnmount(){for(const t in this.loaded)a.form.removePanel(t,this.loaded[t].vapp,this.element),delete this.loaded[t]}}return i}(clickgo.modules.clickgo);