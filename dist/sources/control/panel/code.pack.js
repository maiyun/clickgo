var emodule=function(t){"use strict";function e(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(a){if("default"!==a){var o=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,o.get?o:{enumerable:!0,get:function(){return t[a]}})}}),e.default=t,Object.freeze(e)}var a=e(t);class o extends a.control.AbstractControl{get filename(){return"/code.js"}emits={go:null,went:null};props={modelValue:"",plain:!1,map:null};mapSelected="";loading=!1;loaded={};access={nav:null};activeId="";async hideActive(){if(!this.activeId)return;a.form.removeActivePanel(this,this.activeId,this.formId),await this.loaded[this.activeId].vroot.onHide();this.element.querySelector('[data-panel-id="'+this.activeId.toString()+'"]').style.display="none"}async go(t,e={},o={}){if(this.loading)return!1;const i={detail:{data:e,nav:o.nav??!1,action:o.action??"forword",previous:o.previous??"",qsChange:!1}},s={detail:{action:o.action??"forword",data:e,nav:o.nav??!1,previous:o.previous??"",qsChange:!1}};this.loading=!0,"string"==typeof t&&(t=a.tool.urlResolve(this.path+"/",t));for(const e in this.loaded){const o=this.loaded[e];if(o.obj!==t)continue;if(this.activeId.toString()===e)return this.access.nav&&(o.vroot.qs=a.tool.clone(this.access.nav.qs),await o.vroot.onQsChange(),s.detail.qsChange=!0,await o.vroot.onQsChangeShow(s)),this.loading=!1,!0;await this.hideActive(),this.activeId=e,a.form.setActivePanel(this,this.formId,this.activeId);return this.element.querySelector('[data-panel-id="'+e+'"]').style.display="flex",this.access.nav&&JSON.stringify(o.vroot.qs)!==JSON.stringify(this.access.nav.qs)&&(o.vroot.qs=a.tool.clone(this.access.nav.qs),await o.vroot.onQsChange(),s.detail.qsChange=!0,i.detail.qsChange=!0),await o.vroot.onShow(i),await o.vroot.onQsChangeShow(s),this.loading=!1,!0}try{const e=await a.form.createPanel(this,t);await this.hideActive(),this.activeId=e.id,a.form.setActivePanel(this,this.formId,this.activeId),this.loaded[e.id]={obj:t,vapp:e.vapp,vroot:e.vroot};return this.element.querySelector('[data-panel-id="'+e.id.toString()+'"]').style.display="flex",this.access.nav&&(e.vroot.qs=a.tool.clone(this.access.nav.qs),await e.vroot.onQsChange(),i.detail.qsChange=!0),await e.vroot.onShow(i),await e.vroot.onQsChangeShow(s),this.loading=!1,!0}catch{return this.loading=!1,!1}}send(t){this.activeId&&this.loaded[this.activeId].vroot.onReceive(t)}async mapNameChange(t={}){if(!this.props.map)return void(this.mapSelected="");const e=this.access.nav?this.access.nav.selected:this.props.modelValue;if(e===this.mapSelected)return;const a=this.mapSelected.split("?"),o=e.split("?"),i={go:!0,preventDefault:function(){this.go=!1},detail:{from:a[0],to:o[0]}};if(this.emit("go",i),!i.go)return;const s={detail:{result:await this.go(this.props.map[o[0]],this.rootForm.formHashData,{nav:!!this.access.nav,action:t.action??"forword",previous:t.previous??""}),from:i.detail.from,to:i.detail.to}};this.emit("went",s),s.detail.result&&(this.mapSelected=e,await this.loaded[this.activeId].vroot.onShowed())}onMounted(){this.access.nav=this.parentByName("nav"),this.rootForm.ready(async()=>{this.watch("modelValue",async()=>{await this.mapNameChange()}),this.watch("map",async()=>{await this.mapNameChange()},{deep:!0}),this.access.nav&&this.watch(()=>{const t=a.tool.clone(this.rootForm._historyHash);return this.rootForm.formHash&&t.push(this.rootForm.formHash),t},async(t,e)=>{const a=t.length<e.length?"back":"forword";await this.mapNameChange({action:a,previous:e[e.length-1]})},{deep:!0}),await this.mapNameChange()})}onBeforeUnmount(){for(const t in this.loaded)a.form.removePanel(t,this.loaded[t].vapp,this.element),delete this.loaded[t]}}return o}(clickgo.modules.clickgo);