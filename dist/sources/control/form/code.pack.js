var emodule=function(t){"use strict";function i(t){var i=Object.create(null);return t&&Object.keys(t).forEach(function(h){if("default"!==h){var e=Object.getOwnPropertyDescriptor(t,h);Object.defineProperty(i,h,e.get?e:{enumerable:!0,get:function(){return t[h]}})}}),i.default=t,Object.freeze(i)}var h=i(t);class e extends h.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={max:null,min:null,close:null,"update:width":null,"update:height":null,"update:left":null,"update:top":null,"update:stateMin":null,"update:stateMax":null},this.props={icon:"",title:"title",min:!0,max:!0,close:!0,resize:!0,move:!0,loading:!1,minWidth:200,minHeight:100,border:"normal",background:"",padding:"",direction:"h",stateMin:!1,stateMax:!1,width:300,height:200,left:-1,top:-1},this.isNativeNoFrameFirst=!1,this.stateMinData=!1,this.stateMaxData=!1,this.widthData=0,this.heightData=0,this.leftData=0,this.topData=0,this.isShow=!1,this.iconDataUrl="",this.zIndex=0,this.stateAbs="",this.historyLocation={width:0,height:0,left:0,top:0},this.flashTimer=void 0,this.isInside=!1,this.stepData=[],this.stepValue="",this.stepShowData=!1}get isMin(){return h.tool.getBoolean(this.props.min)}get isMax(){return h.tool.getBoolean(this.props.max)}get isClose(){return h.tool.getBoolean(this.props.close)}get isResize(){return!this.isNativeNoFrameFirst&&h.tool.getBoolean(this.props.resize)}get isMove(){return h.tool.getBoolean(this.props.move)}get isLoading(){return this.isInside?h.tool.getBoolean(this.props.loading):this.parent.loading}get isStateMax(){return h.tool.getBoolean(this.props.stateMax)}get isStateMin(){return h.tool.getBoolean(this.props.stateMin)}get taskPosition(){return h.task.systemTaskInfo.taskId?h.core.config["task.position"]:"bottom"}get isMask(){return!this.isInside&&this.rootForm.isMask}moveMethod(t,i=!1){if(h.dom.hasTouchButMouse(t))return;if(!this.isMove&&!i)return;if(this.isInside)return;h.dom.bindDblClick(t,()=>{this.stateAbs?this.maxVMethod():this.propBoolean("max")&&this.maxMethod()});let e="";h.dom.bindMove(t,{start:(i,h)=>{if(this.stateMaxData){const e={detail:{event:t,action:"move",max:!0,history:{width:this.historyLocation.width,height:this.historyLocation.height,left:this.historyLocation.left,top:this.historyLocation.top}}};this.emit("max",e),this.element.removeAttribute("data-cg-max"),this.stateMaxData=!1,this.emit("update:stateMax",!1);const s=i-this.leftData,a=this.leftData+this.widthData-i,o=this.historyLocation.width/2;this.leftData=s<=o?i-s:a<=o?i-(this.historyLocation.width-a):i-o,this.emit("update:left",this.leftData);const r=h-this.topData,n=this.topData+this.heightData-h,p=this.historyLocation.height/2;this.topData=r<=p?h-r:n<=p?h-(this.historyLocation.height-n):h-p,this.emit("update:top",this.topData),this.propInt("width")?(this.widthData=this.historyLocation.width,this.emit("update:width",this.historyLocation.width)):this.widthData=0,this.propInt("height")?(this.heightData=this.historyLocation.height,this.emit("update:height",this.historyLocation.height)):this.heightData=0}else if(this.stateAbs){this.stateAbs="";const t=i-this.leftData,e=this.leftData+this.widthData-i,s=this.historyLocation.width/2;this.leftData=t<=s?i-t:e<=s?i-(this.historyLocation.width-e):i-s,this.emit("update:left",this.leftData);const a=h-this.topData,o=this.topData+this.heightData-h,r=this.historyLocation.height/2;this.topData=a<=r?h-a:o<=r?h-(this.historyLocation.height-o):h-r,this.emit("update:top",this.topData),this.propInt("width")?(this.widthData=this.historyLocation.width,this.emit("update:width",this.historyLocation.width)):this.widthData=0,this.propInt("height")?(this.heightData=this.historyLocation.height,this.emit("update:height",this.historyLocation.height)):this.heightData=0}else this.stateMinData||(this.historyLocation={width:this.widthData||this.element.offsetWidth,height:this.heightData||this.element.offsetHeight,left:this.leftData,top:this.topData})},move:(t,i)=>{this.leftData+=i.ox,this.emit("update:left",this.leftData),this.topData+=i.oy,this.emit("update:top",this.topData),""!==i.border&&("t"===i.border&&this.isMax||"t"!==i.border&&this.isResize)?""===e?(e=i.border,h.form.showCircular(i.x,i.y),h.form.showRectangle(i.x,i.y,i.border)):(e=i.border,h.form.moveRectangle(i.border)):""!==e&&(e="",h.form.hideRectangle())},end:()=>{if(""!==e){if("t"===e)this.isMax&&(this.widthData=this.propInt("width")?this.historyLocation.width:0,this.heightData=this.propInt("height")?this.historyLocation.height:0,this.leftData=this.historyLocation.left,this.topData=this.historyLocation.top,this.maxMethod());else if(this.isResize){this.stateAbs=e;const t=h.form.getRectByBorder(e);this.widthData=t.width,this.propInt("width")>0&&this.emit("update:width",this.widthData),this.heightData=t.height,this.propInt("height")>0&&this.emit("update:height",this.heightData),this.leftData=t.left,this.emit("update:left",this.leftData),this.topData=t.top,this.emit("update:top",this.topData)}h.form.hideRectangle()}}})}minMethod(t){if(this.isInside)return!0;if(this.stateMinData){const i={detail:{event:t??null,action:t?"click":"method",min:!0,history:{width:this.historyLocation.width,height:this.historyLocation.height,left:this.historyLocation.left,top:this.historyLocation.top}}};this.emit("min",i),this.element.removeAttribute("data-cg-min"),this.stateMinData=!1,this.emit("update:stateMin",!1)}else{const i={detail:{event:t??null,action:t?"click":"method",min:!1,history:null}};this.emit("min",i),this.isNativeNoFrameFirst?h.native.min(this):(this.element.dataset.cgMin="",this.stateMinData=!0,this.emit("update:stateMin",!0),this.formFocus&&h.tool.sleep(100).then(()=>{h.form.changeFocusMaxZIndex().catch(()=>{})}).catch(t=>{throw t}))}return this.trigger("formStateMinChanged",this.stateMinData).catch(()=>{}),!0}maxVMethod(){if(!this.isInside)if(this.stateAbs)this.stateAbs="",this.topData=this.historyLocation.top,this.emit("update:top",this.topData),this.propInt("height")?(this.heightData=this.historyLocation.height,this.emit("update:height",this.heightData)):this.heightData=0;else{this.stateAbs="l",this.historyLocation={width:this.widthData||this.element.offsetWidth,height:this.heightData||this.element.offsetHeight,left:this.leftData,top:this.topData};const t=h.core.getAvailArea();this.topData=t.top,this.emit("update:top",this.topData),this.heightData=t.height,this.propInt("height")&&this.emit("update:height",this.heightData)}}maxMethod(t){if(this.isInside)return!0;if(this.stateMinData&&!this.minMethod())return!1;if(this.stateMaxData){const i={detail:{event:t??null,action:t?"click":"move",max:!0,history:{height:this.historyLocation.height,left:this.historyLocation.left,top:this.historyLocation.top,width:this.historyLocation.width}}};this.emit("max",i),this.element.removeAttribute("data-cg-max"),this.stateMaxData=!1,this.emit("update:stateMax",!1),this.isNativeNoFrameFirst?h.native.restore(this).catch(()=>{}):(this.element.style.transition="all .3s var(--g-cubic)",this.element.style.transitionProperty="left,top,width,height"),this.propInt("width")?(this.widthData=this.historyLocation.width,this.emit("update:width",this.historyLocation.width)):this.widthData=0,this.propInt("height")?(this.heightData=this.historyLocation.height,this.emit("update:height",this.historyLocation.height)):this.heightData=0,this.leftData=this.historyLocation.left,this.emit("update:left",this.historyLocation.left),this.topData=this.historyLocation.top,this.emit("update:top",this.historyLocation.top),this.isNativeNoFrameFirst?h.native.size(this,this.widthData,this.heightData).catch(()=>{}):h.tool.sleep(150).then(()=>{this.element.style.transition=""}).catch(()=>{})}else{const i={detail:{event:t??null,action:t?"click":"move",max:!1,history:null}};this.emit("max",i),this.stateAbs?this.stateAbs="":this.historyLocation={width:this.widthData||this.element.offsetWidth,height:this.heightData||this.element.offsetHeight,left:this.leftData,top:this.topData},this.element.dataset.cgMax="",this.stateMaxData=!0,this.emit("update:stateMax",!0),this.isNativeNoFrameFirst?h.native.max(this).catch(()=>{}):(this.element.style.transition="all .3s var(--g-cubic)",this.element.style.transitionProperty="left,top,width,height",h.tool.sleep(150).then(()=>{this.element.style.transition=""}).catch(()=>{}));const e=h.core.getAvailArea();this.rootForm.bottomMost?(this.leftData=0,this.topData=0,this.widthData=e.owidth,this.heightData=e.oheight):(this.leftData=e.left,this.topData=e.top,this.widthData=e.width,this.heightData=e.height),this.emit("update:left",this.leftData),this.emit("update:top",this.topData),this.propInt("width")>0&&this.emit("update:width",this.widthData),this.propInt("height")>0&&this.emit("update:height",this.heightData)}return this.trigger("formStateMaxChanged",this.stateMaxData).catch(()=>{}),!0}closeMethod(t){if(this.isInside)return;const i={go:!0,preventDefault:function(){this.go=!1},detail:{event:t}};if(this.emit("close",i),i.go){if(this.isNativeNoFrameFirst)return void h.task.end(this).catch(()=>{});h.form.close(this.formId)}}resizeMethod(t,i){if(this.stateMaxData)return;if(h.dom.hasTouchButMouse(t))return;let e="";const s=this.topData,a=this.leftData,o=this.heightData||this.element.offsetHeight,r=this.widthData||this.element.offsetWidth;this.stateAbs||(this.historyLocation={width:r,height:o,left:this.leftData,top:this.topData}),h.dom.bindResize(t,{objectLeft:a,objectTop:s,objectWidth:r,objectHeight:o,minWidth:this.propInt("minWidth"),minHeight:this.propInt("minHeight"),border:i,start:()=>{},move:(t,s,a,o,r,n,p)=>{this.leftData=t,this.emit("update:left",t),this.topData=s,this.emit("update:top",s),this.widthData=a,this.emit("update:width",a),this.heightData=o,this.emit("update:height",o),""!==p?("lt"!==i&&"t"!==i&&"tr"!==i||"lt"!==p&&"t"!==p&&"tr"!==p)&&("bl"!==i&&"b"!==i&&"rb"!==i||"bl"!==p&&"b"!==p&&"rb"!==p)?""!==e&&(e="",h.form.hideRectangle()):""===e?(e=p,this.stateAbs||(h.form.showCircular(r,n),h.form.showRectangle(r,n,{left:t,width:a}))):(e=p,this.stateAbs||h.form.moveRectangle({left:t,width:a})):""!==e&&(e="",h.form.hideRectangle())},end:()=>{if(!e)return;if(this.stateAbs)return;if("l"===e||"r"===e)return;const t=h.core.getAvailArea();this.stateAbs="l",this.heightData=t.height,this.emit("update:height",this.heightData),this.topData=t.top,this.emit("update:top",this.topData),h.form.hideRectangle()}}),"t"!==i&&"b"!==i||h.dom.bindDblClick(t,()=>{this.maxVMethod()})}setPropData(t,i,h=""){switch(t){case"left":switch(h){case"":this.leftData=i;break;case"+":this.leftData+=i;break;default:this.leftData-=i}this.emit("update:left",this.leftData);break;case"top":switch(h){case"":this.topData=i;break;case"+":this.topData+=i;break;default:this.topData-=i}this.emit("update:top",this.topData);break;case"width":if(i){switch(h){case"":this.widthData=i;break;case"+":this.widthData+=i;break;default:this.widthData-=i}this.emit("update:width",this.widthData)}else this.widthData=0,this.emit("update:width",0);break;case"height":if(i){if("number"!=typeof i)break;switch(h){case"":this.heightData=i;break;case"+":this.heightData+=i;break;default:this.heightData-=i}this.emit("update:height",this.heightData)}else this.heightData=0,this.emit("update:height",0)}}stepHide(){this.stepShowData=!1}stepShow(){this.refs.step.style.top=(this.refs.content.offsetHeight/10*9-this.refs.step.offsetHeight).toString()+"px",this.refs.step.style.left=((this.refs.content.offsetWidth-this.refs.step.offsetWidth)/2).toString()+"px",this.stepShowData=!0}async stepDone(){this.stepValue="#",await h.tool.sleep(500),this.stepShowData=!1}stepDown(t){h.dom.bindMove(t,{areaObject:this.refs.content,object:this.refs.step,move:(t,i)=>{this.refs.step.style.left=(parseFloat(this.refs.step.style.left)+i.ox).toString()+"px",this.refs.step.style.top=(parseFloat(this.refs.step.style.top)+i.oy).toString()+"px"}})}onMounted(){if(this.watch("icon",async()=>{if(""===this.props.icon)this.iconDataUrl="";else{const t=await h.fs.getContent(this,this.props.icon);this.iconDataUrl=t instanceof Blob?await h.tool.blob2DataUrl(t):""}this.trigger("formIconChanged",this.iconDataUrl).catch(()=>{})}),this.watch("title",()=>{this.trigger("formTitleChanged",this.props.title).catch(()=>{})}),this.watch("isStateMin",()=>{this.isStateMin!==this.stateMinData&&this.minMethod()}),this.watch("isStateMax",()=>{this.isStateMax!==this.stateMaxData&&this.maxMethod()}),this.watch("isShow",()=>{this.trigger("formShowChanged",this.isShow).catch(()=>{})}),this.watch("width",()=>{this.propInt("width")!==this.widthData&&(this.widthData=this.propInt("width"),this.propInt("width")&&this.widthData<this.propInt("minWidth")&&(this.widthData=this.propInt("minWidth"),this.emit("update:width",this.widthData)))},{immediate:!0}),this.watch("height",()=>{this.propInt("height")!==this.heightData&&(this.heightData=this.propInt("height"),this.propInt("height")&&this.heightData<this.propInt("minHeight")&&(this.heightData=this.propInt("minHeight"),this.emit("update:height",this.heightData)))},{immediate:!0}),this.watch("left",()=>{this.leftData=this.propInt("left")}),this.watch("top",()=>{this.topData=this.propInt("top")}),"root"===this.parent.controlName&&(this.isNativeNoFrameFirst=this.parent.isNativeNoFrameFirst,this.isNativeNoFrameFirst&&(h.native.on(this,"maximize",()=>{this.element.dataset.cgMax="",this.stateMaxData=!0,this.emit("update:stateMax",!0)},!1,this.formId),h.native.on(this,"unmaximize",()=>{this.element.removeAttribute("data-cg-max"),this.stateMaxData=!1,this.emit("update:stateMax",!1)},!1,this.formId),this.watch("max",()=>{h.native.maximizable(this,this.propBoolean("max")).catch(()=>{})},{immediate:!0}))),"root"!==this.parent.controlName&&(this.isInside=!0,this.isShow=!0),this.isStateMax){const t=h.core.getAvailArea();this.leftData=(t.width-this.widthData)/2,this.topData=(t.height-this.heightData)/2,this.maxMethod()}}}return e}(clickgo.modules.clickgo);