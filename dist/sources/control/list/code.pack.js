var emodule=function(e){"use strict";function t(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(l){if("default"!==l){var a=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(t,l,a.get?a:{enumerable:!0,get:function(){return e[l]}})}}),t.default=e,Object.freeze(t)}var l=t(e);class a extends l.control.AbstractControl{get filename(){return"/code.js"}emits={remove:null,add:null,change:null,changed:null,itemclicked:null,itemdblclicked:null,label:null,item:null,load:null,"update:modelValue":null};props={disabled:!1,must:!0,multi:!1,ctrl:!0,selection:!1,gesture:[],scroll:"auto",virtual:!1,plain:!1,tree:!1,treeDefault:0,async:!1,icon:!1,iconDefault:"",check:!1,map:{},mode:"default",data:[],disabledList:[],unavailableList:[],modelValue:[]};dataFormat=[];get value(){if(this.propBoolean("check"))return;let e=!1;const t=l.tool.clone(this.values);if(t.length>1&&!this.propBoolean("multi")&&(e=!0,t.splice(1)),!t.length&&this.propBoolean("must"))return[];const a=[],i=[],o=[];if(t.length>0)for(let l=0;l<t.length;++l){const s=this.findFormat(t[l]);if(s){const e=this.findGl(s[t[l]].value);a.push(e),i.push(s[t[l]].label),o.push(this.dataGl[e])}else e=!0,t.splice(l,1),--l}return e&&this.emit("update:modelValue",t),this.emit("label",i),this.emit("item",o),a}get dataGl(){return this.unpack(this.dataFormat)}get mapComp(){return{children:this.props.map.children??"children",label:this.props.map.label??"label",value:this.props.map.value??"value",title:this.props.map.title??"title",disabled:this.props.map.disabled??"disabled",control:this.props.map.control??"control",unavailable:this.props.map.unavailable??"unavailable",leftline:this.props.map.leftline??"leftline"}}select(e){this.refs.gl.select(e)}refreshOffset(){this.refs.gl.refreshOffset()}findFormat(e,t=!0,l,a){const i={};a??=0,Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;++t)"string"!=typeof e[t]&&(e[t]=e[t].toString());l??=this.dataFormat;for(const o of l){if(e.includes(o.value)&&(i[o.value]=o,Object.keys(i).length===e.length))return i;const l=this.findFormat(e,t,o.children,a+1);if(Object.keys(l).length&&(t&&0===o.tree&&(o.tree=1),Object.assign(i,l),Object.keys(i).length===e.length))return l}return a||Object.keys(i).length?i:null}arrowUp(){this.refs.gl.arrowUp()}arrowDown(){this.refs.gl.arrowDown()}updateModelValue(e){if(this.propBoolean("check"))return;const t=[],a=[],i=[];for(const l of e)this.dataGl[l]&&(t.push(this.dataGl[l].value),a.push(this.dataGl[l].label),i.push(this.dataGl[l]));this.values=t,this.emit("update:modelValue",l.tool.clone(t)),this.emit("label",a),this.emit("item",i)}formatData(e,t){if(!Array.isArray(e)){const t=[];for(const l in e){const a=e[l];"string"!=typeof a?(a.value=l,t.push(a)):t.push({value:l,label:a})}e=t}const l=[],a=[];for(const e of t)a.push(e.value);for(let i=0;i<e.length;++i){const o=e[i],s={label:"",value:"",title:!1,disabled:!1,color:void 0,control:"item",tree:this.propInt("treeDefault"),children:[],data:o};let r="object"==typeof o?o[this.mapComp.value]??o[this.mapComp.label]??i:o;"number"==typeof r&&(r=r.toString());const n=a.indexOf(r);"object"==typeof o?(s.label=o[this.mapComp.label]??o[this.mapComp.value]??i,s.value=r,s.title=void 0!==o[this.mapComp.title]&&o[this.mapComp.title],s.disabled=void 0!==o[this.mapComp.disabled]?o[this.mapComp.disabled]:!!s.title,s.control=o[this.mapComp.control],s.unavailable=o[this.mapComp.unavailable],s.leftline=o[this.mapComp.leftline],s.color=o.color?"tip"===o.color?"var(--g-color-disabled)":o.color:void 0,s.control=o.control??"item",o.icon&&(s.icon=o.icon),o.openicon&&(s.openicon=o.openicon),void 0!==o.tree&&(s.tree=o.tree),o[this.mapComp.children]?.length>0&&(s.children=this.formatData(o[this.mapComp.children],-1!==n?t[n].children:[]))):(s.label=r,s.value=r),-1!==n&&(s.tree=t[n].tree),2===s.tree?0===s.children.length?s.tree=-1:s.tree=1:1===s.tree&&0===s.children.length&&(s.tree=0),l.push(s)}return l}unpack(e,t=0){const l=[],a=this.propArray("disabledList"),i=this.propArray("unavailableList");for(const o of e){let e=o.tree;0!==o.children.length||this.propBoolean("async")||(e=-1),l.push({label:o.label,value:o.value,title:o.title,disabled:!!a.includes(o.value)||o.disabled,unavailable:!!i.includes(o.value)||o.unavailable,leftline:o.leftline,color:o.color,control:o.control,tree:e,icon:o.icon??this.props.iconDefault,openicon:o.openicon??o.icon??this.props.iconDefault,level:t,format:o,data:o.data}),this.propBoolean("tree")&&1!==e||l.push(...this.unpack(o.children,t+1))}return l}findGl(e){for(let t=0;t<this.dataGl.length;++t)if(this.dataGl[t].value===e)return t;return null}treeClick(e,t){if(t.format.tree>-1&&e.stopPropagation(),0===t.format.tree)this.propBoolean("async")&&!t.format.children.length?(t.format.tree=2,this.emit("load",t.value,e=>{if(!e?.length)return t.format.children=[],void(t.format.tree=-1);t.format.children=this.formatData(e,[]),t.format.tree=1})):t.format.tree=1;else if(1===t.format.tree&&(t.format.tree=0,!this.propBoolean("check")))for(const l of this.props.modelValue){if(!this.findFormat(l,!1,t.format.children))continue;this.emit("update:modelValue",[t.value]),this.emit("label",[t.label]),this.emit("item",[t]);const a={detail:{event:e,value:t.value,arrow:!1}};this.emit("itemclicked",a);break}}onAdd(e){const t={go:!0,preventDefault:function(){this.go=!1},detail:{index:e.detail.index,value:this.dataGl[e.detail.value].value}};this.emit("add",t),t.go||e.preventDefault()}onRemove(e){const t={go:!0,preventDefault:function(){this.go=!1},detail:{index:e.detail.index,value:this.dataGl[e.detail.value].value}};this.emit("remove",t),t.go||e.preventDefault()}onChange(e){const t={go:!0,preventDefault:function(){this.go=!1},detail:{value:void 0===e.detail.value[0]?[]:[this.dataGl[e.detail.value[0]].value]}};this.emit("change",t),t.go||e.preventDefault()}onChanged(e){const t={detail:{value:void 0===e.detail.value[0]?[]:[this.dataGl[e.detail.value[0]].value]}};this.emit("changed",t)}onItemclicked(e){const t={detail:{event:e.detail.event,value:this.dataGl[e.detail.value].value,arrow:e.detail.arrow}};this.emit("itemclicked",t)}onItemdblclicked(e){const t={detail:{event:e.detail.event,value:this.dataGl[e.detail.value].value,arrow:e.detail.arrow}};this.emit("itemdblclicked",t)}values=[];onCheckChange(e,t){if(e.preventDefault(),t.format.children.length){return void(this.childrenTotal(t,{check:!e.detail.value||!!e.detail.indeterminate}).change&&this.emit("update:modelValue",l.tool.clone(this.values)))}const a=this.values.indexOf(t.value);-1===a?this.values.push(t.value):this.values.splice(a,1),this.emit("update:modelValue",l.tool.clone(this.values))}get isChecked(){return e=>{if(e.format.children.length){return this.childrenTotal(e).check>0}return this.values.includes(e.value)}}get isIndeterminate(){return e=>{if(e.format.children.length){const t=this.childrenTotal(e);return 0!==t.check&&t.check<t.total}return!1}}get childrenTotal(){return(e,t={})=>{const l={total:0,check:0,change:!1};if(Array.isArray(e)){for(const a of e){this.childrenTotal(a,t).change&&(l.change=!0)}return l}if(e.format&&(e=e.format),!e.children?.length){if(t.checkValues){const l=t.checkValues.wait.indexOf(e.value);l>-1&&t.checkValues.result.push(t.checkValues.wait[l])}return l}for(const a of e.children){if(a.children?.length){const e=this.childrenTotal(a,t);l.total+=e.total,l.check+=e.check,e.change&&(l.change=!0);continue}if(t.checkValues){const e=t.checkValues.wait.indexOf(a.value);e>-1&&t.checkValues.result.push(t.checkValues.wait[e])}if(++l.total,void 0===t.check)this.values.includes(a.value)&&++l.check;else if(t.check)this.values.includes(a.value)||(this.values.push(a.value),l.change=!0),++l.check;else{const e=this.values.indexOf(a.value);e>-1&&(this.values.splice(e,1),l.change=!0)}}return l}}refreshCheckValues(){const e=l.tool.clone(this.values),t=[];this.childrenTotal(this.dataGl,{checkValues:{wait:e,result:t}});const a=l.tool.compar(this.values,t);(a.length.add||a.length.remove)&&(this.values=t,this.emit("update:modelValue",this.values))}onMounted(){this.watch("check",()=>{this.propBoolean("check")&&this.refreshCheckValues()}),this.watch(()=>JSON.stringify(this.props.data),(e,t)=>{if(e!==t)this.dataFormat=(Array.isArray(this.props.data)?this.props.data.length:Object.keys(this.props.data).length)?this.formatData(this.props.data,this.dataFormat):[],this.propBoolean("check")&&this.refreshCheckValues();else for(const e of this.dataGl)-1===e.format.tree&&(e.format.tree=0)},{deep:!0}),this.watch("map",()=>{this.dataFormat=this.formatData(this.props.data,this.dataFormat),this.propBoolean("check")&&this.refreshCheckValues()},{deep:!0}),this.watch("modelValue",()=>{this.values.length===this.propArray("modelValue").length&&this.values.every(e=>this.propArray("modelValue").includes(e))||(this.values=l.tool.clone(this.propArray("modelValue")),this.propBoolean("check")&&this.refreshCheckValues())},{deep:!0}),this.dataFormat=this.formatData(this.props.data,this.dataFormat),this.values=l.tool.clone(this.propArray("modelValue")),this.propBoolean("check")&&this.refreshCheckValues()}}return a}(clickgo.modules.clickgo);