var emodule=function(t){"use strict";function e(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return t[i]}})}}),e.default=t,Object.freeze(e)}var i=e(t);class s extends i.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={add:null,added:null,remove:null,removed:null,change:null,changed:null,tagclick:null,itemclicked:null,remote:null,load:null,label:null,"update:modelValue":null},this.props={disabled:!1,editable:!1,multi:!1,plain:!1,virtual:!1,search:!1,remote:!1,remoteDelay:500,tree:!1,treeDefault:0,async:!1,icon:!1,iconDefault:"",map:{},padding:"m",leftlabel:!0,minWidth:0,modelValue:[],placeholder:"",data:[],disabledList:[],unavailableList:[]},this.localeData={en:{search:"Search"},sc:{search:"搜索"},tc:{search:"搜尋"},ja:{search:"検索"},ko:{search:"검색"},th:{search:"ค้นหา"},es:{search:"buscar"},de:{search:"suchen"},fr:{search:"rechercher"},pt:{search:"pesquisar"},ru:{search:"поиск"},vi:{search:"tìm kiếm"}},this.value=[],this.label=[],this.inputValue="",this.searchValue="",this.searchData=[],this.listValue=[],this.listLabel=[],this.listItem=[],this.loading=0,this._needSearch=0,this.searching=0}get isMust(){return!this.propBoolean("editable")&&(!this.propBoolean("search")&&!this.propBoolean("multi"))}get listMulti(){return!this.propBoolean("editable")&&(!this.propBoolean("search")&&this.propBoolean("multi"))}get labelMode(){return!this.propBoolean("multi")&&!this.propBoolean("editable")}get dataComp(){if(!this.propBoolean("search"))return this.props.data;return(this.propBoolean("editable")?this.inputValue:this.searchValue).trim()?this.searchData:this.props.data}updateValue(t={}){this.emit("update:modelValue",i.tool.clone(this.value)),this.emit("label",i.tool.clone(this.label)),t.clearList&&(this.listValue.length=0,this.listLabel.length=0),t.clearInput&&(this.inputValue="",this.searchValue="")}blur(){if(this.propBoolean("multi"))this.inputValue="";else{if(this.inputValue===this.listValue[0])return;if(Array.isArray(this.dataComp))for(const t of this.dataComp){let e="",i="";if("string"==typeof t?(e=t,i=t):(e=t.label??t.value??"",i=t.value??t.label??""),i.toLowerCase()===this.inputValue.toLowerCase()||e.toLowerCase()===this.inputValue.toLowerCase())return this.inputValue=i,this.value=[i],this.label=[e],this.listValue=[this.inputValue],void this.updateValue()}else for(const t in this.dataComp){const e="string"==typeof this.dataComp[t]?this.dataComp[t]:this.dataComp[t].label??t??"",i=t;if(i.toLowerCase()===this.inputValue.toLowerCase()||e.toLowerCase()===this.inputValue.toLowerCase())return this.inputValue=i,this.value=[i],this.label=[e],this.listValue=[this.inputValue],void this.updateValue()}}}async keydown(t){if("Backspace"!==t.key){if("Enter"===t.key&&void 0===this.element.dataset.cgPopOpen&&this.propBoolean("multi")){if(t.stopPropagation(),!this.inputValue)return void this.refs.gs.showPop();if(this.value.includes(this.inputValue))return this.inputValue="",void this.refs.gs.hidePop();const e=this.value.length,i={go:!0,preventDefault:function(){this.go=!1},detail:{index:e,value:this.inputValue}};return this.emit("add",i),void(i.go&&(this.value.push(this.inputValue),this.label.push(this.listLabel[0]??this.inputValue),this.updateValue({clearInput:!0,clearList:!0}),this.emit("added",{detail:{index:e,value:this.inputValue}}),this.propBoolean("search")&&await this._search()))}if(("ArrowDown"===t.key||"Enter"===t.key)&&void 0===this.element.dataset.cgPopOpen)return t.stopPropagation(),void this.refs.gs.showPop();await this.textKeyDown(t)}else if(this.propBoolean("multi")&&""===t.target.value&&this.propBoolean("multi")&&this.value.length>0){const t=this.value.length-1,e=this.value[t],i={go:!0,preventDefault:function(){this.go=!1},detail:{index:t,value:e,mode:"backspace"}};this.emit("remove",i),i.go&&(this.value.splice(-1),this.label.splice(-1),this.updateValue(),this.emit("removed",{detail:{index:t,value:e,mode:"backspace"}}))}}async textKeyDown(t){if(t.stopPropagation(),("ArrowUp"===t.key||"ArrowDown"===t.key)&&void 0!==this.element.dataset.cgPopOpen){if(t.preventDefault(),"ArrowUp"===t.key)this.refs.list.arrowUp(),this.inputValue=this.listValue[0]??"",this.searchValue=this.listValue[0]??"";else this.refs.list.arrowDown(),this.inputValue=this.listValue[0]??"",this.searchValue=this.listValue[0]??"";return void await this.updateInputValue(this.propBoolean("editable")?this.inputValue:this.searchValue)}if("Enter"!==t.key)return;const e=this.searchValue||this.inputValue;if(this.propBoolean("editable"))if(this.propBoolean("multi")){if(!e)return void this.refs.gs.hidePop();if(this.value.includes(e))return this.inputValue="",void this.refs.gs.hidePop();const t=this.value.length,i={go:!0,preventDefault:function(){this.go=!1},detail:{index:t,value:e}};this.emit("add",i),i.go&&(this.value.push(e),this.label.push(this.listLabel[0]??e),this.updateValue({clearInput:!0,clearList:!0}),this.emit("added",{detail:{index:t,value:e}}),this.refs.gs.hidePop(),this.propBoolean("search")&&await this._search())}else{if(!e)return void this.refs.gs.hidePop();this.value=[e],this.listValue=[e],await this.nextTick(),this.label=[this.listLabel[0]??e],this.updateValue(),this.refs.gs.hidePop()}else if(this.propBoolean("multi")){if(!e)return;if(this.value.includes(e))return this.searchValue="",this.refs.gs.hidePop(),void await this._search();if(!this.listValue[0])return this.searchValue="",this.refs.gs.hidePop(),void await this._search();const t=this.value.length,i={go:!0,preventDefault:function(){this.go=!1},detail:{index:t,value:e}};this.emit("add",i),i.go&&(this.value.push(e),this.label.push(this.listLabel[0]??""),this.searchValue="",this.updateValue(),this.emit("added",{detail:{index:t,value:e}}),this.refs.gs.hidePop(),await this._search())}else{if(!this.listValue[0])return this.searchValue="",this.refs.gs.hidePop(),void await this._search();this.value=[this.listValue[0]??""],this.label=[this.listLabel[0]??""],this.searchValue="",this.updateValue(),this.refs.gs.hidePop(),await this._search()}}async _search(t){const e=(this.propBoolean("editable")?this.inputValue:this.searchValue).trim();if(this.propBoolean("remote")){const s=this.propInt("remoteDelay");if(++this._needSearch,await i.tool.sleep(s),this._needSearch>1)return void--this._needSearch;if(0===this._needSearch)return;if(--this._needSearch,""===e)return this.searchData=[],await this.nextTick(),void await(t?.());++this.searching;const a={detail:{value:e,callback:async e=>{--this.searching,this.searchData=e?i.tool.clone(e):[],await this.nextTick(),await(t?.())}}};this.emit("remote",a)}else{if(await this.nextTick(),this._needSearch>1)return void--this._needSearch;if(--this._needSearch,""===e)return this.searchData=[],await this.nextTick(),void await(t?.());if(Array.isArray(this.props.data)){this.searchData=[];for(const t of this.props.data){const i=("object"==typeof t?t.value??"":t).toString().toLowerCase(),s=("object"==typeof t?t.label??"":"").toLowerCase();let a=!0;for(const t of e){const e=t.toLowerCase();if(!i.includes(e)&&!s.includes(e)){a=!1;break}}a&&this.searchData.push(t)}}else{this.searchData={};for(const t in this.props.data){const i=this.props.data[t],s=t.toLowerCase(),a="";let l=!0;for(const t of e){const e=t.toLowerCase();if(!s.includes(e)&&!a.includes(e)){l=!1;break}}l&&(this.searchData[t]=i)}}await(t?.())}}async updateSearchValue(t){this.searchValue=t.trim(),await this._search(()=>{this.listValue=[this.searchValue]})}async updateInputValue(t){if(t=t.trim(),this.propBoolean("editable")&&!this.propBoolean("multi")){const e={go:!0,preventDefault:function(){this.go=!1},detail:{value:[t]}};if(this.emit("change",e),!e.go)return}if(this.inputValue=t,this.propBoolean("search")&&(void 0===this.element.dataset.cgPopOpen&&this.refs.gs.showPop(),await this._search(()=>{this.listValue=[this.inputValue]})),this.propBoolean("multi"))return void(this.propBoolean("search")||(this.listValue=[this.inputValue]));const e=i.tool.clone(this.value);if(""===this.inputValue?(this.value=[],this.label=[],this.listValue=[]):(this.value=[this.inputValue],this.label=[this.inputValue],this.listValue=[this.inputValue],await this.nextTick(),this.listLabel[0]&&(this.label=i.tool.clone(this.listLabel))),this.updateValue(),this.propBoolean("editable")&&!this.propBoolean("multi")){const i={detail:{before:e,value:[t]}};this.emit("changed",i)}}async listItemClicked(t){const e={detail:{event:t.detail.event,value:t.detail.value,arrow:t.detail.arrow}};if(this.emit("itemclicked",e),this.propBoolean("editable")){const t=this.listValue[0]??"";if(this.propBoolean("multi")){if(this.value.includes(t))return void this.refs.gs.hidePop();const e=this.value.length,i={go:!0,preventDefault:function(){this.go=!1},detail:{index:e,value:t}};this.emit("add",i),i.go&&(this.value.push(t),this.label.push(this.listLabel[0]??""),this.updateValue({clearInput:!0,clearList:!0}),this.emit("added",{detail:{index:e,value:this.inputValue}}),this.propBoolean("search")?(this.refs.gs.hidePop(),await this._search()):this.refs.gs.hidePop())}else{if(this.inputValue!==t){const e={go:!0,preventDefault:function(){this.go=!1},detail:{value:[t]}};if(this.emit("change",e),e.go){this.inputValue=t;const e=i.tool.clone(this.value);this.value=[t],this.label=[this.listLabel[0]??""],this.updateValue(),this.propBoolean("search")&&await this._search();const s={detail:{before:e,value:[t]}};this.emit("changed",s)}}this.refs.gs.hidePop()}}else if(this.propBoolean("multi")){if(this.propBoolean("search")){if(this.value.includes(this.listValue[0]??""))return this.refs.gs.hidePop(),this.searchValue="",void await this._search();const t=this.value.length,e={go:!0,preventDefault:function(){this.go=!1},detail:{index:t,value:this.listValue[0]??""}};this.emit("add",e),e.go&&(this.value.push(this.listValue[0]??""),this.label.push(this.listLabel[0]??""),this.updateValue({clearInput:!0,clearList:!0}),this.emit("added",{detail:{index:t,value:this.inputValue}}),this.refs.gs.hidePop(),await this._search())}}else{const t=i.tool.clone(this.value);this.value=[this.listValue[0]??""],this.label=[this.listLabel[0]??""],this.propBoolean("search")?(this.updateValue({clearInput:!0}),this.refs.gs.hidePop(),await this._search()):(this.updateValue(),this.refs.gs.hidePop());const e={detail:{before:t,value:this.value}};this.emit("changed",e)}}onAdd(t){if(!this.propBoolean("multi"))return;if(this.propBoolean("search"))return;const e={go:!0,preventDefault:function(){this.go=!1},detail:{index:this.value.length,value:t.detail.value}};if(this.emit("add",e),!e.go)return void t.preventDefault();this.value.push(t.detail.value);const i=this.refs.list.findFormat(t.detail.value,!1);this.label.push(i?.[t.detail.value].label??"error"),this.updateValue(),this.emit("added",e)}onRemove(t){if(!this.propBoolean("multi"))return;if(this.propBoolean("search"))return;const e=t.detail.index,i={go:!0,preventDefault:function(){this.go=!1},detail:{index:e,value:t.detail.value,mode:"list"}};this.emit("remove",i),i.go?(this.value.splice(t.detail.index,1),this.label.splice(t.detail.index,1),this.updateValue(),this.emit("removed",{detail:{index:e,value:t.detail.value,mode:"list"}})):t.preventDefault()}onChange(t){if(this.propBoolean("multi"))return;if(this.propBoolean("search"))return;if(this.propBoolean("editable"))return;const e={go:!0,preventDefault:function(){this.go=!1},detail:{value:t.detail.value}};this.emit("change",e),e.go||t.preventDefault()}tagClick(t){const e={detail:{index:t,value:this.value[t]}};this.emit("tagclick",e)}removeTag(t){if(this.isMust&&1===this.value.length)return;const e=this.value[t],s={go:!0,preventDefault:function(){this.go=!1},detail:{index:t,value:e,mode:"tag"}};this.emit("remove",s),s.go&&(this.value.splice(t,1),this.label.splice(t,1),this.listValue=i.tool.clone(this.value),this.updateValue(),this.emit("removed",{detail:{index:t,value:e,mode:"tag"}}))}tagsWheel(t){0!==t.deltaY&&(t.preventDefault(),this.refs.tags.scrollLeft+=t.deltaY)}async tagdown(t){i.dom.hasTouchButMouse(t)||(t.stopPropagation(),await i.form.doFocusAndPopEvent(t))}onLoad(t,e){this.emit("load",t,e)}onPop(){this.refs.list.refreshOffset()}onMounted(){let t=!0;this.watch("modelValue",async()=>{if(t)t=!1;else if(JSON.stringify(this.value)===JSON.stringify(this.props.modelValue))return;if(this.propBoolean("editable")){if(this.props.modelValue.length){if(this.propBoolean("multi")){this.inputValue="",this.searchValue="",this.value.length=0,this.label.length=0;for(const t of this.props.modelValue){const e=t.toString(),i=this.refs.list.findFormat(e,!1);i?.[e]?(this.value.push(i[e].value),this.label.push(i[e].label)):(this.value.push(e),this.label.push(e))}return void this.updateValue()}this.inputValue=this.props.modelValue[0].toString(),this.value=[this.inputValue];const t=this.refs.list.findFormat(this.inputValue,!1);return this.label=[t?.[this.inputValue]?t[this.inputValue].label:this.inputValue],this.listValue=[this.inputValue],void this.updateValue()}return this.value.length=0,this.label.length=0,void this.updateValue({clearInput:!0,clearList:!0})}if(this.props.modelValue.length){if(this.propBoolean("multi")){this.value.length=0,this.label.length=0;for(const t of this.props.modelValue){const e=t.toString(),i=this.refs.list.findFormat(e,!1);i?.[e]&&(this.value.push(i[e].value),this.label.push(i[e].label))}return this.updateValue(),void(this.listValue=this.value)}return this.listValue=[this.props.modelValue[0].toString()],await this.nextTick(),await i.tool.sleep(0),this.value=i.tool.clone(this.listValue),this.label=i.tool.clone(this.listLabel),void this.updateValue()}this.listValue=[],await this.nextTick(),await i.tool.sleep(0),this.value=i.tool.clone(this.listValue),this.label=i.tool.clone(this.listLabel),this.updateValue()},{immediate:!0,deep:!0}),this.watch("search",async()=>{await this.nextTick(),this.listValue=i.tool.clone(this.value),this.propBoolean("search")&&(this.searchValue="",await this._search())}),this.watch("remote",async()=>{this.propBoolean("search")&&await this._search()}),this.watch("editable",async()=>{if(this.propBoolean("editable"))this.propBoolean("multi")||(this.inputValue=(this.value[0]??"").toString());else if(this.propBoolean("multi")){if(await this.nextTick(),this.listValue=i.tool.clone(this.value),await this.nextTick(),JSON.stringify(this.value)===JSON.stringify(this.listValue))return;this.value=i.tool.clone(this.listValue),this.label=i.tool.clone(this.listLabel),this.updateValue()}}),this.watch("multi",()=>{if(!this.propBoolean("multi"))return this.value.length>1&&(this.value.splice(1),this.label.splice(1),this.updateValue(),this.listValue=i.tool.clone(this.value)),void(this.propBoolean("editable")&&(this.inputValue=(this.value[0]??"").toString()));this.propBoolean("editable")&&(this.inputValue="")}),this.watch(()=>JSON.stringify(this.props.data),async(t,e)=>{if(t!==e){if(this.propBoolean("editable")){if(await this._search(),this.propBoolean("multi"))return;if(this.listValue=this.value,await this.nextTick(),this.label[0]===this.listLabel[0])return;return this.listValue.length?this.label=i.tool.clone(this.listLabel):this.label[0]=this.value[0],void this.emit("label",i.tool.clone(this.label))}await this.nextTick(),await i.tool.sleep(0),JSON.stringify(this.value)!==JSON.stringify(this.listValue)&&(this.value=i.tool.clone(this.listValue),this.emit("update:modelValue",i.tool.clone(this.value))),JSON.stringify(this.label)!==JSON.stringify(this.listLabel)&&(this.label=i.tool.clone(this.listLabel),this.emit("label",i.tool.clone(this.label)))}})}}return s}(clickgo.modules.clickgo);