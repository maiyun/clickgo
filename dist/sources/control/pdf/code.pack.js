var emodule=function(t){"use strict";function i(t){var i=Object.create(null);return t&&Object.keys(t).forEach(function(s){if("default"!==s){var e=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(i,s,e.get?e:{enumerable:!0,get:function(){return t[s]}})}}),i.default=t,Object.freeze(i)}var s=i(t);class e extends s.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={loaded:null,view:null},this.props={disabled:!1,src:"",page:1},this.notInit=!1,this.isLoading=!0,this.access={pdfjs:void 0,pdf:void 0,context:void 0},this.count=0}async load(t){return!!this.access.pdfjs&&(t instanceof Blob&&(t=await s.tool.blob2ArrayBuffer(t)),this.isLoading=!0,this.access.pdf=await this.access.pdfjs.getDocument(t).promise,this.isLoading=!1,await this.go(),this.emit("loaded",this.access.pdf),!0)}async go(){this.isLoading=!0;let t=null;try{t=await this.access.pdf.getPage(this.propInt("page"))}catch{return this.isLoading=!1,!1}this.access.context??=this.refs.content.getContext("2d");const i=t.getViewport({scale:1}),e={detail:{width:i.width,height:i.height,inwidth:Math.round(i.width/72*100)/100,inheight:Math.round(i.height/72*100)/100,pxwidth:0,pxheight:0}},o=t.getViewport({scale:e.detail.inwidth*s.dom.dpi/i.width});return e.detail.pxwidth=Math.round(o.width),e.detail.pxheight=Math.round(o.height),this.refs.content.width=e.detail.pxwidth,this.refs.content.height=e.detail.pxheight,t.render({canvasContext:this.access.context,viewport:o}),this.emit("view",e),this.isLoading=!1,!0}async onMounted(){if(this.access.pdfjs=await s.core.getModule("pdfjs"),!this.access.pdfjs)return this.isLoading=!1,void(this.notInit=!0);this.watch("src",async()=>{const t=++this.count;if("string"!=typeof this.props.src||""===this.props.src)return this.access.pdf=void 0,void this.emit("loaded",this.access.pdf);const i=this.props.src.slice(0,6).toLowerCase();if("file:/"===i)return this.access.pdf=void 0,void this.emit("loaded",this.access.pdf);if(i.startsWith("data:"))return this.access.pdf=void 0,void this.emit("loaded",this.access.pdf);let e=null;if(this.props.src.startsWith("/control/")){if(!this.rootControl)return;e=this.rootControl.packageFiles[this.props.src.slice(8)]}else{const t=s.tool.urlResolve("/package"+this.path+"/",this.props.src);e=await s.fs.getContent(this,t)}t===this.count&&e&&"string"!=typeof e&&await this.load(e)},{immediate:!0}),this.watch("page",async()=>{this.access.pdf&&await this.go()},{deep:!0}),this.isLoading=!1}}return e}(clickgo.modules.clickgo);