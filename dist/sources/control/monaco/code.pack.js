var emodule=function(e){"use strict";function t(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(s){if("default"!==s){var o=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:function(){return e[s]}})}}),t.default=e,Object.freeze(t)}var s=t(e);class o extends s.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={jump:null,init:null,"update:files":null,"update:modelValue":null},this.props={disabled:!1,readonly:!1,modelValue:"",language:"",theme:"",files:{}},this.access={instance:void 0,monaco:void 0},this.notInit=!1,this.isLoading=!0,this.localeData={en:{copy:"Copy",cut:"Cut",paste:"Paste"},sc:{copy:"复制",cut:"剪下",paste:"粘上"},tc:{copy:"複製",cut:"剪貼",paste:"貼上"},ja:{copy:"コピー",cut:"切り取り",paste:"貼り付け"},ko:{copy:"복사",cut:"잘라내기",paste:"붙여넣기"},th:{copy:"คัดลอก",cut:"ตัด",paste:"วาง"},es:{copy:"Copiar",cut:"Cortar",paste:"Pegar"},de:{copy:"Kopieren",cut:"Ausschneiden",paste:"Einfügen"},fr:{copy:"Copier",cut:"Couper",paste:"Coller"},pt:{copy:"Copiar",cut:"Recortar",paste:"Colar"},ru:{copy:"Копировать",cut:"Вырезать",paste:"Вставить"},vi:{copy:"Sao chép",cut:"Cắt",paste:"Dán"}}}get showMask(){return!!this.isLoading||s.dom.is.move}setValue(e,t){e.pushEditOperations([],[{range:e.getFullModelRange(),text:t??e.getValue()}],()=>{})}async execCmd(e){switch(e){case"copy":s.tool.execCommand(e);break;case"cut":{s.tool.execCommand("copy");const e=this.access.instance.getSelection();this.access.instance.executeEdits("",[{range:new this.access.monaco.Range(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),text:""}]);break}case"paste":{const e=await navigator.clipboard.readText(),t=this.access.instance.getSelection();this.access.instance.executeEdits("",[{range:new this.access.monaco.Range(t.startLineNumber,t.startColumn,t.endLineNumber,t.endColumn),text:e}]);break}}}refreshModels(){const e=[],t=this.access.monaco.editor.getModels();let s=!1;for(const o of t)void 0!==this.props.files[o.uri.path]?e.push(o.uri.path):(o.dispose(),s=!0);for(const t in this.props.files){if(e.includes(t)){const e=this.access.monaco.editor.getModel(this.access.monaco.Uri.parse(t));e.getValue()!==this.props.files[t]&&(this.setValue(e,this.props.files[t]),s=!0);continue}const o=this.access.monaco.editor.createModel(this.props.files[t],void 0,this.access.monaco.Uri.parse(t));o.pushEOL(0),o.onDidChangeContent(()=>{this.props.files[t]=o.getValue(),this.emit("update:files",this.props.files)}),s=!0}if("typescript"===this.props.language&&s){const e=this.access.instance.getModel();e&&this.setValue(e)}}async onMounted(){this.watch("readonly",()=>{this.access.instance&&this.access.instance.updateOptions({readOnly:!!this.propBoolean("disabled")||this.propBoolean("readonly")})}),this.watch("disabled",()=>{this.access.instance&&this.access.instance.updateOptions({readOnly:!!this.propBoolean("disabled")||this.propBoolean("readonly")})}),this.watch("files",(e,t)=>{if(this.access.instance)if(void 0!==e)if(void 0===t){let e=this.access.monaco.editor.getModels()[0];e&&e.dispose(),e=this.access.monaco.editor.getModel(this.access.monaco.Uri.parse(this.props.modelValue)),e&&(this.access.instance.setModel(e),this.props.language&&this.access.monaco.editor.setModelLanguage(e,this.props.language.toLowerCase()))}else this.refreshModels();else{const e=this.access.monaco.editor.getModels();for(const t of e)t.dispose();const t=this.access.monaco.editor.createModel(this.props.modelValue,this.props.language);t.pushEOL(0),t.onDidChangeContent(()=>{this.emit("update:modelValue",t.getValue())}),this.access.instance.setModel(t)}},{deep:!0}),this.watch("modelValue",()=>{if(this.access.instance)if(Object.keys(this.props.files).length){const e=this.access.monaco.editor.getModel(this.access.monaco.Uri.parse(this.props.modelValue));e&&(this.access.instance.setModel(e),this.props.language&&(this.access.monaco.editor.setModelLanguage(e,this.props.language.toLowerCase()),"typescript"===this.props.language&&this.setValue(e)))}else{const e=this.access.instance.getModel();if(this.props.modelValue===e.getValue())return;this.setValue(e,this.props.modelValue)}}),this.watch("language",()=>{if(!this.access.instance)return;if(!this.props.language)return;const e=this.access.instance.getModel();e&&(this.access.monaco.editor.setModelLanguage(e,this.props.language.toLowerCase()),"typescript"===this.props.language&&this.setValue(e))}),this.watch("theme",()=>{this.access.instance&&this.access.monaco.editor.setTheme(this.props.theme)});const e=this.refs.iframe;if(!e.contentWindow)return;const t=e.contentWindow,o=t.document;o.body.style.margin="0",o.body.style.overflow="hidden";const a=o.createElement("div");a.id="monaco",a.style.height="100%",o.body.append(a);const i=await s.core.getModule("monaco-editor");if(!i)return this.isLoading=!1,void(this.notInit=!0);const n=o.createElement("script");n.addEventListener("load",()=>{t.require.config({paths:{vs:s.getCdn()+"/npm/monaco-editor@0.52.2/min/vs"}});const e=t.URL.createObjectURL(new Blob([`\n                self.MonacoEnvironment = {\n                    baseUrl: '${s.getCdn()}/npm/monaco-editor@0.52.2/min/'\n                };\n                importScripts('${s.getCdn()}/npm/monaco-editor@0.52.2/min/vs/base/worker/workerMain.js');\n            `],{type:"text/javascript"}));t.MonacoEnvironment={getWorkerUrl:()=>e},t.require(["vs/editor/editor.main"],e=>{this.access.monaco=e,this.access.instance=this.access.monaco.editor.create(a,{model:null,contextmenu:!1,minimap:{enabled:!1},readOnly:this.props.readonly,automaticLayout:!0}),this.access.instance._codeEditorService.openCodeEditor=e=>(this.emit("jump",e),this.access.instance),this.props.theme&&this.access.monaco.editor.setTheme(this.props.theme),navigator.clipboard&&a.addEventListener("contextmenu",e=>{if(e.preventDefault(),s.dom.hasTouchButMouse(e))return;const t=this.element.getBoundingClientRect();s.form.showPop(this.element,this.refs.pop,{x:t.left+e.clientX,y:t.top+e.clientY})});const t=e=>{s.dom.hasTouchButMouse(e)||(e instanceof TouchEvent&&s.dom.bindLong(e,()=>{s.form.showPop(this.element,this.refs.pop,e)}),s.form.changeFocus(this.formId).catch(()=>{}),s.form.hidePop())};if(a.addEventListener("mousedown",t),a.addEventListener("touchstart",t,{passive:!0}),Object.keys(this.props.files).length){this.refreshModels();const e=this.access.monaco.editor.getModel(this.access.monaco.Uri.parse(this.props.modelValue));e&&(this.access.instance.setModel(e),this.props.language&&this.access.monaco.editor.setModelLanguage(e,this.props.language.toLowerCase()))}else{const e=this.access.monaco.editor.createModel(this.props.modelValue,this.props.language);e.pushEOL(0),e.onDidChangeContent(()=>{this.emit("update:modelValue",e.getValue())}),this.access.instance.setModel(e)}s.dom.watchStyle(this.element,["font-size","font-family"],(e,t)=>{switch(e){case"font-size":o.body.style.fontSize=t,this.access.instance.updateOptions({fontSize:t});break;case"font-family":o.body.style.fontFamily=t,this.access.instance.updateOptions({fontFamily:t})}},!0),this.isLoading=!1,this.emit("init",{monaco:this.access.monaco,instance:this.access.instance})})}),n.src=i,o.head.append(n)}}return o}(clickgo.modules.clickgo);