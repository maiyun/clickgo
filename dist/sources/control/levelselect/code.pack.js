var emodule=function(e){"use strict";function l(e){var l=Object.create(null);return e&&Object.keys(e).forEach(function(t){if("default"!==t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(l,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}}),l.default=e,Object.freeze(l)}var t=l(e);class i extends t.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={label:null,load:null,loaded:null,level:null,"update:modelValue":null},this.props={disabled:!1,async:!1,plain:!1,virtual:!1,map:{},padding:void 0,minWidth:0,modelValue:"",placeholder:"",data:[]},this.localeData={en:{back:"Back"},sc:{back:"返回"},tc:{back:"返回"},ja:{back:"戻る"},ko:{back:"뒤로"},th:{back:"ย้อนกลับ"},es:{back:"Volver"},de:{back:"Zurück"},fr:{back:"Retour"},pt:{back:"Voltar"},ru:{back:"Назад"},vi:{back:"Quay lại"}},this.level=0,this.value=[],this.label=[],this.inputValue="",this.listValue=[],this.listLabel=[],this.oploading=!1,this.loading=!1,this.lists=[[]],this.nowlist=[],this.levelData=[{label:"",value:""}],this._fvid={level:0,value:[],label:[],lists:[],levelData:[]}}get nowlistComp(){if(""===this.inputValue)return this.nowlist;const e=this.inputValue.toLowerCase(),l=[];for(const t of this.nowlist){const i=("object"==typeof t?t.value??"":t).toString().toLowerCase(),s=("object"==typeof t?t.label??"":"").toLowerCase();let a=!0;for(const l of e)if(!i.includes(l)&&!s.includes(l)){a=!1;break}a&&l.push(t)}return l}updateValue(){const e={detail:{list:[],values:[],labels:[]}};if(this.value.length<2){if(this.emit("label",""),this.emit("level",e),""===this.props.modelValue)return;return void this.emit("update:modelValue","")}this.emit("label",this.label[this.label.length-2]);for(let l=0;l<this.levelData.length-1;++l)e.detail.list.push({label:this.levelData[l].label,value:this.levelData[l].value}),e.detail.values.push(this.levelData[l].value),e.detail.labels.push(this.levelData[l].label);this.emit("level",e);const l=this.value[this.value.length-2];this.props.modelValue!==l&&this.emit("update:modelValue",l)}async _findValueInDataAndSelectValueCheckChildren(e,l=!0,i=!1){if(!e){if(!this.propBoolean("async"))return i&&t.form.hidePop(),++this.level,this.listValue=[],this.nowlist=[],this.value[this.level]="",this.label[this.level]="",this.lists[this.level]=[],this.levelData[this.level]={label:"",value:""},l&&this.updateValue(),!1;this.loading=!0;const s=await new Promise(e=>{this.emit("load",this.value[this.level],l=>{e(l),this.emit("loaded")})});if(this.loading=!1,!s?.length)return i&&t.form.hidePop(),++this.level,this.listValue=[],this.nowlist=[],this.value[this.level]="",this.label[this.level]="",this.lists[this.level]=[],this.levelData[this.level]={label:"",value:""},l&&this.updateValue(),!1;e=s}return++this.level,this.listValue=[],this.setNowList(e),this.value[this.level]="",this.label[this.level]="",this.lists[this.level]=e,this.levelData[this.level]={label:"",value:""},l&&this.updateValue(),!0}async findValueInData(e,l){l||(l=this.props.data,this._fvid.level=0,this._fvid.value=[""],this._fvid.label=[""],this._fvid.lists=[l],this._fvid.levelData=[{label:"",value:""}]);let t=null;const i=Array.isArray(l);for(const s in l){const a=l[s],h=(i?"object"==typeof a?a.value??a.label??"":a:s).toString();if(e===h)return t=a.children??null,this.level=this._fvid.level,this._fvid.value[this._fvid.level]=h,this._fvid.label[this._fvid.level]=a.label??h,this._fvid.lists[this._fvid.level]=l,this._fvid.levelData[this._fvid.level]={value:this._fvid.value[this._fvid.level],label:this._fvid.label[this._fvid.level]},this.value=this._fvid.value,this.label=this._fvid.label,this.lists=this._fvid.lists,this.levelData=this._fvid.levelData,await this._findValueInDataAndSelectValueCheckChildren(t),!0;if(a.children){if(this._fvid.value[this._fvid.level]=h,this._fvid.label[this._fvid.level]=a.label??h,this._fvid.lists[this._fvid.level]=l,this._fvid.levelData[this._fvid.level]={value:this._fvid.value[this._fvid.level],label:this._fvid.label[this._fvid.level]},++this._fvid.level,await this.findValueInData(e,a.children))return!0;this._fvid.value.splice(-1),this._fvid.label.splice(-1),this._fvid.lists.splice(-1),this._fvid.levelData.splice(-1),--this._fvid.level}}return!1}async blur(){await t.tool.sleep(350),this.inputValue=""}async keydown(e){if("Backspace"!==e.key)if("ArrowDown"!==e.key||void 0!==this.element.dataset.cgPopOpen)if("ArrowUp"!==e.key&&"ArrowDown"!==e.key||void 0===this.element.dataset.cgPopOpen)"Enter"===e.key&&this.listValue[0]&&(e.stopPropagation(),await this.listItemClicked());else if(e.preventDefault(),"ArrowUp"===e.key)this.refs.list.arrowUp();else this.refs.list.arrowDown();else this.refs.gs.showPop();else this.level>0&&""===e.target.value&&this.back()}updateInputValue(e){this.inputValue=e.trim(),this.listValue=[this.inputValue],""===this.inputValue||void 0!==this.element.dataset.cgPopOpen||this.refs.gs.showPop()}setNowList(e){this.nowlist.length=0;const l=t.tool.clone(e);if(Array.isArray(l))this.nowlist=l;else for(const e in l)l[e].value=e,this.nowlist.push(l[e]);for(const e of this.nowlist)delete e.children}async listItemClicked(){this.inputValue="";let e=null,l=!1;const t=Array.isArray(this.lists[this.level]);for(const i in this.lists[this.level]){const s=this.lists[this.level][i],a=(t?"object"==typeof s?s.value??s.label??"":s:i).toString();this.listValue[0]===a&&(e=s.children??null,l=!0,this.value[this.level]=this.listValue[0],this.label[this.level]=this.listLabel[0],this.levelData[this.level]={label:this.label[this.level],value:this.value[this.level]})}l&&await this._findValueInDataAndSelectValueCheckChildren(e,!0,!0)}back(){this.value.splice(-1),this.label.splice(-1),this.lists.splice(-1),this.levelData.splice(this.level),--this.level,this.listValue=[],this.value[this.level]="",this.label[this.level]="",this.levelData[this.level]={label:"",value:""},this.setNowList(this.lists[this.level]),this.updateValue()}async selectLevelValue(e){this.level=0,this.listValue=[],this.value=[""],this.label=[""],this.setNowList(this.props.data),this.lists=[this.props.data],this.levelData=[{label:"",value:""}];for(let l=0;l<e.length&&(this.level=l,e[l]);++l){const t=await this._selectValue(e[l]);if(await this.nextTick(),!t)break}this.updateValue()}async _selectValue(e){let l=null,t=!1;const i=Array.isArray(this.lists[this.level]);for(const s in this.lists[this.level]){const a=this.lists[this.level][s],h=(i?"object"==typeof a?a.value??a.label??"":a:s).toString();e===h&&(l=a.children??null,t=!0,this.value[this.level]=h,this.label[this.level]=a.label??h,this.levelData[this.level]={value:this.value[this.level],label:this.label[this.level]})}return!!t&&this._findValueInDataAndSelectValueCheckChildren(l,!1)}onMounted(){this.watch("data",()=>{this.level=0,this.listValue=[],this.value=[""],this.label=[""],this.setNowList(this.props.data),this.lists=[this.props.data],this.levelData=[{label:"",value:""}],this.updateValue()},{deep:!0}),this.watch("modelValue",async()=>{const e=this.props.modelValue.toString();if(""===e){if(1===this.value.length)return;return this.level=0,this.value=[""],this.label=[""],this.setNowList(this.props.data),this.lists=[this.props.data],this.levelData=[{label:"",value:""}],void this.updateValue()}this.value.length>1&&e===this.value[this.level-1]||(await this._selectValue(e)?this.updateValue():await this.findValueInData(e)||1!==this.value.length&&(this.level=0,this.value=[""],this.label=[""],this.setNowList(this.props.data),this.lists=[this.props.data],this.levelData=[{label:"",value:""}],this.updateValue()))}),this.setNowList(this.props.data),this.lists[0]=this.props.data}}return i}(clickgo.modules.clickgo);