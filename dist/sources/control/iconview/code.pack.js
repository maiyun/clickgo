var emodule=function(t){"use strict";function e(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(s){if("default"!==s){var i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:function(){return t[s]}})}}),e.default=t,Object.freeze(e)}var s=e(t);class i extends s.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={beforeselect:null,select:null,afterselect:null,itemclicked:null,open:null,drop:null,client:null,gesture:null,"update:modelValue":null},this.props={disabled:!1,plain:!1,must:!1,multi:!0,ctrl:!0,selection:!0,gesture:[],scroll:"auto",size:100,name:!0,data:[],modelValue:[]},this.rand="",this.focus=!1,this.client=0,this.length=0,this.offset=0,this.cw=0,this.valueData=[],this.shiftStart=0,this.selectValues=[],this.beforeSelectValues=[],this.isSelectStart=!1,this.scrollShow=!0,this.rowCount=1,this.iconsData=[],this.dataCount=0}get isSelected(){return t=>this.valueData.includes(t)}get timeFormat(){return t=>{const e=new Date(1e3*t);return(this.propInt("size")>=128?e.getFullYear().toString()+"-":"")+(e.getMonth()+1).toString().padStart(2,"0")+"-"+e.getDate().toString().padStart(2,"0")+" "+e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")}}clientwidth(t){this.cw=t,this.rowCount=Math.floor(this.cw/(this.propInt("size")+80)),this.rowCount<1&&(this.rowCount=1)}get dataComp(){const t=[];let e=this.rowCount;const i=s.tool.clone(this.props.data);for(const s of i)++e,e===this.rowCount+1&&(e=1,t.push([])),s.type??=1,t[t.length-1].push(s);const a=this.rowCount-e;if(a>0)for(let e=0;e<a;++e)t[t.length-1].push({type:-1});return t}get getIconData(){return t=>{const e=t.slice(0,6).toLowerCase();return"file:/"===e||"http:/"===e||"https:"===e||e.startsWith("data:")?t:this.iconsData[t]??""}}arrowUp(){if(0===this.shiftStart)return;const t=Math.ceil((this.shiftStart+1)/this.rowCount)-1,e=this.shiftStart%this.rowCount;if(0===t)return;const s=(t-1)*this.rowCount;this.select(s+e)}arrowDown(){if(this.shiftStart===this.props.data.length-1)return;const t=Math.ceil((this.shiftStart+1)/this.rowCount)-1,e=this.shiftStart%this.rowCount;if(t===Math.ceil(this.props.data.length/this.rowCount)-1)return;const s=(t+1)*this.rowCount+e;this.props.data[s]?this.select(s):this.select(this.props.data.length-1)}arrowLeft(){if(0===this.shiftStart)return;if(this.shiftStart%this.rowCount>0)return void this.select(this.shiftStart-1);const t=Math.ceil((this.shiftStart+1)/this.rowCount)-1;0!==t&&this.select(t*this.rowCount-1)}arrowRight(){if(this.shiftStart===this.props.data.length-1)return;if(this.shiftStart%this.rowCount<this.rowCount-1){if(!this.props.data[this.shiftStart+1])return;return void this.select(this.shiftStart+1)}const t=Math.ceil((this.shiftStart+1)/this.rowCount)-1;t!==Math.ceil(this.props.data.length/this.rowCount)-1&&this.select((t+1)*this.rowCount)}checkValue(){if(!this.props.data.length)return;let t=!1;const e=this.props.data.length-1;!this.propBoolean("multi")&&this.valueData.length>1&&(t=!0,this.valueData.splice(1),this.shiftStart=this.valueData[0]);for(let s=0;s<this.valueData.length;++s)this.valueData[s]>e&&(t=!0,this.shiftStart===this.valueData[s]&&(this.shiftStart=s>0?this.valueData[0]??0:0),this.valueData.splice(s,1),--s);this.propBoolean("must")&&0===this.valueData.length&&(t=!0,this.valueData=[0],this.shiftStart=this.valueData[0]),t&&this.emit("update:modelValue",this.valueData)}select(t,e=!1,s=!1){let i=!1;if(t<-1&&(t=-1),this.propBoolean("must")&&-1===t)return;const a=t=>!!this.props.data[t];if(e||s)if(-1===t);else if(e){const e=[];if(t>this.shiftStart)for(let s=this.shiftStart;s<=t;++s)a(s)&&(i=!0,e.push(s));else for(let s=this.shiftStart;s>=t;--s)a(s)&&(i=!0,e.push(s));e.length===this.valueData.length&&e.every(t=>this.valueData.includes(t))||(i=!0,this.valueData=e)}else{const e=this.valueData.indexOf(t);e>-1?(!this.propBoolean("must")||this.valueData.length>1)&&(i=!0,this.valueData.splice(e,1),this.shiftStart=t):a(t)&&(i=!0,this.shiftStart=t,this.propBoolean("multi")?this.valueData.push(t):this.valueData=[t])}else-1===t?this.valueData.length>0&&(i=!0,this.valueData=[]):this.valueData.length>1||0===this.valueData.length?a(t)&&(i=!0,this.valueData=[t],this.shiftStart=t):this.valueData[0]!==t&&a(t)&&(i=!0,this.valueData[0]=t,this.shiftStart=t);i&&this.emit("update:modelValue",this.valueData)}down(t){s.dom.hasTouchButMouse(t)||(void 0!==this.refs.flow.$el.dataset.cgPopOpen&&s.form.hidePop(),this.propBoolean("must")||void 0!==t.target.dataset.cgItem||s.dom.findParentByData(t.target,"cg-item")||s.dom.bindClick(t,()=>{this.select(-1,t.shiftKey,t.ctrlKey)}),t instanceof TouchEvent&&s.dom.bindLong(t,()=>{this.propBoolean("must")||void 0!==t.target.dataset.cgItem||s.dom.findParentByData(t.target,"cg-item")||this.select(-1),this.valueData.length>0?s.form.showPop(this.refs.flow.$el,this.refs.itempop,t):s.form.showPop(this.refs.flow.$el,this.refs.pop,t)}))}itemDown(t,e,i){const a=e*this.rowCount+i;t instanceof TouchEvent&&s.dom.bindLong(t,()=>{this.isSelected(a)||this.select(i,t.shiftKey,!(this.propBoolean("ctrl")||!this.propBoolean("multi"))||t.ctrlKey)}),s.dom.bindClick(t,()=>{this.select(a,t.shiftKey,!(this.propBoolean("ctrl")||!this.propBoolean("multi"))||t.ctrlKey);const e={detail:{event:t,value:i}};this.emit("itemclicked",e)}),s.dom.bindDrag(t,{el:t.currentTarget,start:()=>{this.isSelected(a)||this.select(a);const t=[];for(const e of this.valueData)t.push({index:e,type:this.props.data[e].type,path:this.props.data[e].path});s.dom.setDragData({rand:this.rand,type:"fs",list:t})}}),s.dom.bindDblClick(t,()=>{const t={detail:{value:[i]}};this.emit("open",t)})}itemContext(t,e,i){if(s.dom.hasTouchButMouse(t))return;const a=e*this.rowCount+i;this.isSelected(a)||this.select(a,t.shiftKey,t.ctrlKey)}context(t){s.dom.hasTouchButMouse(t)||(this.propBoolean("must")||void 0!==t.target.dataset.cgItem||s.dom.findParentByData(t.target,"cg-item")||this.select(-1),this.valueData.length>0?s.form.showPop(this.refs.flow.$el,this.refs.itempop,t):s.form.showPop(this.refs.flow.$el,this.refs.pop,t))}keydown(t){if(["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Enter"].includes(t.key))if(t.preventDefault(),"ArrowUp"===t.key)this.arrowUp();else if("ArrowDown"===t.key)this.arrowDown();else if("ArrowLeft"===t.key)this.arrowLeft();else if("ArrowRight"===t.key)this.arrowRight();else{if(!this.valueData.length)return;const t={detail:{value:s.tool.clone(this.valueData)}};this.emit("open",t)}}drop(t,e,s){if("object"!=typeof t.detail.value)return;if("fs"!==t.detail.value.type)return;const i=[];for(const e of t.detail.value.list)i.push({index:e.index??0,type:e.type??-1,path:e.path??""});const a=e*this.rowCount+s,h={detail:{self:t.detail.value.rand===this.rand,from:i,to:{index:a,type:this.props.data[a].type,path:this.props.data[a].path??""}}};this.emit("drop",h)}onBeforeSelect(){this.isSelectStart=!0,this.selectValues=[],this.beforeSelectValues=this.valueData,this.emit("beforeselect")}onSelect(t){const e=this.cw/this.rowCount,s=Math.floor(t.x/e),i=Math.floor((t.x+t.width)/e);if(this.propBoolean("multi"))if(t.shift||t.ctrl)if(t.empty){for(const t of this.selectValues)this.select(t,!1,!0);this.selectValues=[]}else if(t.shift){for(let e=t.start;e<=t.end;++e){const t=e*this.rowCount;for(let e=s;e<=i;++e){const s=t+e;this.props.data[s]&&(this.selectValues.includes(s)||this.beforeSelectValues.includes(s)||(this.selectValues.push(s),this.select(s,!1,!0)))}}for(let e=0;e<this.selectValues.length;++e){const a=Math.ceil((this.selectValues[e]+1)/this.rowCount)-1,h=this.selectValues[e]%this.rowCount;a>=t.start&&a<=t.end&&h>=s&&h<=i||(this.select(this.selectValues[e],!1,!0),this.selectValues.splice(e,1),--e)}}else{for(let e=t.start;e<=t.end;++e){const t=e*this.rowCount;for(let e=s;e<=i;++e){const s=t+e;this.props.data[s]&&(this.selectValues.includes(s)||(this.beforeSelectValues.includes(s),this.selectValues.push(s),this.select(s,!1,!0)))}}for(let e=0;e<this.selectValues.length;++e){const a=Math.ceil((this.selectValues[e]+1)/this.rowCount)-1,h=this.selectValues[e]%this.rowCount;a>=t.start&&a<=t.end&&h>=s&&h<=i||(this.select(this.selectValues[e],!1,!0),this.selectValues.splice(e,1),--e)}}else if(t.empty)this.select(-1),this.selectValues.length=0;else{let e=!1;for(let a=t.start;a<=t.end;++a){const t=a*this.rowCount;for(let a=s;a<=i;++a){const s=t+a;this.props.data[s]&&(this.selectValues.includes(s)||(this.selectValues.push(s),e=!0))}}for(let a=0;a<this.selectValues.length;++a){const h=Math.ceil((this.selectValues[a]+1)/this.rowCount)-1,o=this.selectValues[a]%this.rowCount;if(!(h>=t.start&&h<=t.end&&o>=s&&o<=i)){if(this.propBoolean("must")&&1===this.selectValues.length)break;this.selectValues.splice(a,1),--a,e=!0}}e?(this.valueData=this.selectValues,this.emit("update:modelValue",this.valueData)):!this.propBoolean("must")&&0===this.selectValues.length&&this.valueData.length>0&&(this.valueData=[],this.emit("update:modelValue",this.valueData))}else t.empty||this.select(t.start*this.rowCount+s,t.shift,t.ctrl);const a={detail:{area:{x:t.x,y:t.y,width:t.width,height:t.height,shift:t.shift,ctrl:t.ctrl,start:t.start,end:t.end,empty:t.empty}}};this.emit("select",a)}onAfterSelect(){this.isSelectStart=!1,this.emit("afterselect")}async refreshIconsData(){const t=[];for(const e of this.props.data){if(!e.icon)continue;const s=e.icon.slice(0,6).toLowerCase();"file:/"!==s&&("http:/"===s||"https:"===s||s.startsWith("data:")||t.push(e.icon))}for(const e in this.iconsData)t.includes(e)||delete this.iconsData[e];for(const e of t)void 0===this.iconsData[e]&&(this.iconsData[e]="");const e=++this.dataCount;for(const t in this.iconsData){if(this.iconsData[t])continue;const i=s.tool.urlResolve("/package"+this.path+"/",t),a=await s.fs.getContent(this,i);if(e!==this.dataCount)return;if(!a||"string"==typeof a){this.iconsData[t]="";continue}const h=await s.tool.blob2DataUrl(a);if(e!==this.dataCount)return;h?this.iconsData[t]=h:this.iconsData[t]=""}}onMounted(){this.watch("must",()=>{this.propBoolean("must")&&0===this.valueData.length&&(this.props.data[this.shiftStart]?this.valueData=[this.shiftStart]:(this.valueData=[0],this.shiftStart=this.valueData[0]),this.emit("update:modelValue",this.valueData))}),this.watch("multi",()=>{!this.propBoolean("multi")&&this.valueData.length>1&&(this.valueData.splice(1),this.shiftStart=this.valueData[0],this.emit("update:modelValue",this.valueData))}),this.watch("size",()=>{this.rowCount=Math.floor(this.cw/(this.propInt("size")+80)),this.rowCount<1&&(this.rowCount=1)}),this.watch("shiftStart",()=>{const t=(e=0)=>{if(this.isSelectStart)return;const i=Math.ceil((this.shiftStart+1)/this.rowCount)-1,a=this.refs.flow.getPos(i);a?a.start<this.offset?this.offset=a.start:a.end>this.offset+this.client&&(this.offset=a.end-this.client):0===e&&s.task.sleep(this,()=>{t(e+1)},50)};t()}),this.watch("data",async()=>{this.checkValue(),await this.refreshIconsData()},{deep:!0}),this.watch("modelValue",()=>{this.valueData.length===this.props.modelValue.length&&this.valueData.every(t=>this.props.modelValue.includes(t))||(this.valueData=this.props.modelValue,void 0!==this.valueData[0]&&(this.shiftStart=this.valueData[0]),this.checkValue())}),this.valueData=this.props.modelValue,this.valueData[0]&&(this.shiftStart=this.valueData[0]),this.checkValue(),this.refreshIconsData(),this.rand=s.tool.random(16)}}return i}(clickgo.modules.clickgo);