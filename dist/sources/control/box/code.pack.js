var emodule=function(t){"use strict";function e(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(s){if("default"!==s){var i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:function(){return t[s]}})}}),e.default=t,Object.freeze(e)}var s=e(t);class i extends s.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={"update:selected":null},this.props={modelValue:{},selected:[]},this.isInteract=!1,this.isSelection=!1,this.selectedData=[]}get modelValueComp(){const t=Object.keys(this.props.modelValue).map(t=>({id:t,...this.props.modelValue[t]}));return t.sort((t,e)=>(t.index??1)-(e.index??1)),t}wrapDown(t){if(s.dom.hasTouchButMouse(t))return;if(t.target!==t.currentTarget)return;t.ctrlKey||t.metaKey||(this.selectedData.length=0,this.updateSelected());const e=this.element.getBoundingClientRect(),i=t instanceof MouseEvent?t.clientX:t.touches[0].clientX,o=t instanceof MouseEvent?t.clientY:t.touches[0].clientY;s.dom.bindDown(t,{start:()=>{this.isSelection=!0},move:t=>{const s=t instanceof MouseEvent?t.clientX:t.touches[0].clientX,r=t instanceof MouseEvent?t.clientY:t.touches[0].clientY;s>i?(this.refs.selection.setAttribute("x",(i-e.left).toString()),this.refs.selection.setAttribute("width",(s-i).toString())):(this.refs.selection.setAttribute("x",(s-e.left).toString()),this.refs.selection.setAttribute("width",(i-s).toString())),r>o?(this.refs.selection.setAttribute("y",(o-e.top).toString()),this.refs.selection.setAttribute("height",(r-o).toString())):(this.refs.selection.setAttribute("y",(r-e.top).toString()),this.refs.selection.setAttribute("height",(o-r).toString()))},end:t=>{const e=Math.round(parseFloat(this.refs.selection.getAttribute("x"))),s=Math.round(parseFloat(this.refs.selection.getAttribute("width")))+e,i=Math.round(parseFloat(this.refs.selection.getAttribute("y"))),o=Math.round(parseFloat(this.refs.selection.getAttribute("height")))+i;t.ctrlKey||t.metaKey||(this.selectedData.length=0);for(const t in this.props.modelValue){const r=this.props.modelValue[t];s<r.x||e>r.x+r.width||o<r.y||i>r.y+r.height||(this.selectedData.includes(t)||this.selectedData.push(t))}this.updateSelected(),this.refs.selection.setAttribute("x","0"),this.refs.selection.setAttribute("y","0"),this.refs.selection.setAttribute("width","1"),this.refs.selection.setAttribute("height","1"),this.isSelection=!1}})}resize(t,e,i){s.dom.hasTouchButMouse(t)||s.dom.bindResize(t,{objectLeft:this.props.modelValue[e].x,objectTop:this.props.modelValue[e].y,objectWidth:this.props.modelValue[e].width,objectHeight:this.props.modelValue[e].height,border:i,start:()=>{this.isInteract=!0},move:(t,s,i,o)=>{let r=this.props.modelValue[e],l=r.x;r.x=t,l=r.x-l;let c=r.y;r.y=s,c=r.y-c;let h=r.width;r.width=i,h=r.width-h;let n=r.height;r.height=o,n=r.height-n;for(const t of this.selectedData)t!==e&&(r=this.props.modelValue[t],r.x+=l,r.y+=c,r.width+=h,r.height+=n)},end:()=>{this.isInteract=!1}})}down(t,e){s.dom.hasTouchButMouse(t)||(this.selectedData.includes(e)||(t.ctrlKey||t.metaKey||(this.selectedData.length=0),this.selectedData.push(e)),this.updateSelected(),!1!==this.props.modelValue[e].move&&s.dom.bindMove(t,{areaObject:this.element,object:t.currentTarget,cursor:"auto",start:()=>{this.isInteract=!0},move:(t,e)=>{for(const t of this.selectedData)this.props.modelValue[t].x+=e.ox,this.props.modelValue[t].y+=e.oy},end:()=>{this.isInteract=!1}}))}onMounted(){this.watch("modelValue",()=>{for(let t=0;t<this.selectedData.length;++t){const e=this.selectedData[t];this.props.modelValue[e]||(this.selectedData.splice(t,1),--t)}this.updateSelected()}),this.watch("selected",()=>{this.selectedData=s.tool.clone(this.propArray("selected"))},{deep:!0,immediate:!0})}updateSelected(){this.selectedData.length===this.propArray("selected").length&&this.selectedData.every(t=>this.propArray("selected").includes(t))||this.emit("update:selected",s.tool.clone(this.selectedData))}}return i}(clickgo.modules.clickgo);