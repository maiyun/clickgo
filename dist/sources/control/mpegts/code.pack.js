var emodule=function(t){"use strict";function s(t){var s=Object.create(null);return t&&Object.keys(t).forEach(function(i){if("default"!==i){var e=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(s,i,e.get?e:{enumerable:!0,get:function(){return t[i]}})}}),s.default=t,Object.freeze(s)}var i=s(t);class e extends i.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={canplay:null,init:null,"update:play":null,"update:volume":null},this.props={src:"",fsrc:"",text:"",controls:!1,volume:80,play:!1,reset:0},this.access={instance:void 0,mpegts:void 0,ctx:void 0},this.notInit=!1,this.isLoading=!0,this.isShow=!1,this.hideTimer=0,this.volumeSave=0,this.volumeData=0,this.playData=!1,this._waitingTimer=0}toPlay(){const t=this.isFull&&this.props.fsrc||this.props.src;this.access.instance=this.access.mpegts.createPlayer({type:"mse",isLive:!0,url:t},{enableStashBuffer:!1,stashInitialSize:128,enableWorkerForMSE:!0,lazyLoad:!1,lazyLoadMaxDuration:.2,liveBufferLatencyChasing:!0,liveBufferLatencyMinRemain:.2,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:10,autoCleanupMinBackwardDuration:10}),this.access.instance.attachMediaElement(this.refs.video),this.access.instance.load(),this.access.instance.on(this.access.mpegts.Events.ERROR,(t,s,i)=>{console.log("[ERROR][CONTROL][MPEGTS]","ERROR",t,s,i),this.capture(),this.access.instance?.destroy(),this.toPlay()}),this.access.instance.on(this.access.mpegts.Events.STATISTICS_INFO,()=>{}),this.access.instance.play()}playClick(){this.playData?this.access.instance&&(this.capture(),this.access.instance?.destroy(),this.access.instance=void 0):this.toPlay(),this.playData=!this.playData,this.emit("update:play",this.playData)}capture(){this.access.instance&&this.refs.video&&(this.refs.canvas.width=this.refs.video.videoWidth,this.refs.canvas.height=this.refs.video.videoHeight,this.refs.canvas.style.aspectRatio=this.refs.video.videoWidth+" / "+this.refs.video.videoHeight,this.access.ctx.drawImage(this.refs.video,0,0,this.refs.video.videoWidth,this.refs.video.videoHeight,0,0,this.refs.canvas.width,this.refs.canvas.height))}clear(){this.access.ctx.clearRect(0,0,this.refs.canvas.width,this.refs.canvas.height)}async fullClick(){if(i.dom.is.full){if(await i.dom.exitFullscreen(),!this.access.instance)return;return await i.tool.sleep(150),void(this.props.fsrc&&(this.capture(),this.access.instance?.destroy(),this.toPlay()))}await this.element.requestFullscreen(),this.access.instance&&(await i.tool.sleep(150),this.props.fsrc&&this.props.fsrc!==this.props.src&&(this.capture(),this.access.instance?.destroy(),this.toPlay()))}get isFull(){return i.dom.is.full}onMouseEnter(t){i.dom.hasTouchButMouse(t)||this.propBoolean("controls")&&(this.isShow=!0,this.hideTimer&&(i.task.removeTimer(this,this.hideTimer),this.hideTimer=0))}onMouseLeave(t){i.dom.hasTouchButMouse(t)||this.propBoolean("controls")&&(this.hideTimer=i.task.sleep(this,()=>{this.isShow=!1},800))}onTouch(t){this.propBoolean("controls")&&i.dom.bindDown(t,{down:()=>{this.isShow=!0,this.hideTimer&&(i.task.removeTimer(this,this.hideTimer),this.hideTimer=0)},up:()=>{this.hideTimer=i.task.sleep(this,()=>{this.isShow=!1},800)}})}onCanplay(){this.playData=this.propBoolean("play"),this.playData&&this.access.instance&&this.access.instance.play(),this.emit("canplay")}onPlaying(){this.clear(),this._waitingTimer&&(i.task.removeTimer(this,this._waitingTimer),this._waitingTimer=0)}onPause(){this._waitingTimer&&i.task.removeTimer(this,this._waitingTimer),this._waitingTimer=i.task.createTimer(this,()=>{this._waitingTimer=0,this.access.instance&&(this.capture(),this.access.instance?.destroy(),this.toPlay())},5e3,{count:1})}onWaiting(){this._waitingTimer&&i.task.removeTimer(this,this._waitingTimer),this._waitingTimer=i.task.createTimer(this,()=>{this._waitingTimer=0,this.access.instance&&(this.capture(),this.access.instance?.destroy(),this.toPlay())},5e3,{count:1})}volumeClick(){if(this.volumeData)return this.refs.video.volume=0,this.volumeData=0,void this.emit("update:volume",0);this.refs.video.volume=this.volumeSave/100,this.volumeData=this.volumeSave,this.emit("update:volume",this.volumeData)}async onMounted(){const t=await i.core.getModule("mpegts");if(!t)return this.isLoading=!1,void(this.notInit=!0);this.access.mpegts=t,this.access.ctx=this.refs.canvas.getContext("2d"),this.watch("volume",()=>{this.volumeData!==this.propInt("volume")&&(this.refs.video.volume=this.propInt("volume")/100,this.volumeData=this.propInt("volume"),this.propInt("volume")&&(this.volumeSave=this.propInt("volume")))},{immediate:!0}),this.watch("controls",()=>{this.propBoolean("controls")?(this.isShow=!0,this.hideTimer=i.task.sleep(this,()=>{this.isShow=!1},800)):this.hideTimer&&(i.task.removeTimer(this,this.hideTimer),this.hideTimer=0)},{immediate:!0}),this.watch("play",()=>{this.playData!==this.propBoolean("play")&&(this.playData=this.propBoolean("play"),this.playData?this.toPlay():(this.capture(),this.access.instance?.destroy(),this.access.instance=void 0))}),this.playData=this.propBoolean("play"),this.watch("src",(t,s)=>{if(t!==s){if(!this.props.src){if(!this.access.instance)return;return this.access.instance?.destroy(),void(this.access.instance=void 0)}this.access.instance&&this.access.instance?.destroy(),this.playData&&this.toPlay()}},{immediate:!0});let s=0;this.watch("reset",()=>{if(!this.propInt("reset")){if(!s)return;return i.task.removeTimer(this,s),void(s=0)}s&&i.task.removeTimer(this,s),s=i.task.createTimer(this,()=>{this.access.instance&&(this.capture(),this.access.instance?.destroy(),this.toPlay())},this.propInt("reset"))},{immediate:!0}),this.volumeSave=this.propInt("volume"),this.volumeData=this.propInt("volume"),this.isLoading=!1,this.emit("init",{mpegts:this.access.mpegts,instance:this.access.instance})}onUnmounted(){this.access.instance&&this.access.instance?.destroy()}}return e}(clickgo.modules.clickgo);