var emodule=function(s){"use strict";function t(s){var t=Object.create(null);return s&&Object.keys(s).forEach(function(e){if("default"!==e){var i=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(t,e,i.get?i:{enumerable:!0,get:function(){return s[e]}})}}),t.default=s,Object.freeze(t)}var e=t(s);class i extends e.control.AbstractControl{get filename(){return"/code.js"}emits={canplay:null,init:null,"update:play":null,"update:volume":null};props={src:"",fsrc:"",text:"",controls:!1,volume:80,play:!1,reset:0};access={instance:void 0,mpegts:void 0,ctx:void 0};notInit=!1;isLoading=!0;isShow=!1;hideTimer=0;volumeSave=0;volumeData=0;_resetTimer=0;toPlay(){if(!this.access.mpegts)return;if(!(this.refs.video instanceof HTMLVideoElement))return;const s=this.isFull&&this.props.fsrc||this.props.src;this.access.instance=this.access.mpegts.createPlayer({type:"mse",isLive:!0,url:s},{enableStashBuffer:!1,stashInitialSize:128,enableWorkerForMSE:!0,lazyLoad:!1,lazyLoadMaxDuration:.2,liveBufferLatencyChasing:!0,liveBufferLatencyMinRemain:.2,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:10,autoCleanupMinBackwardDuration:10}),this.access.instance.attachMediaElement(this.refs.video),this.access.instance.load(),this.access.instance.on(this.access.mpegts.Events.ERROR,this.onError),this.access.instance.on(this.access.mpegts.Events.STATISTICS_INFO,()=>{}),this.access.instance.play()}playData=!1;playClick(){this.playData?this.access.instance&&(this.capture(),this.access.instance.destroy(),this.access.instance=void 0):this.toPlay(),this.playData=!this.playData,this.emit("update:play",this.playData)}capture(){this.access.instance&&this.refs.video&&(this.refs.canvas.width=this.refs.video.videoWidth,this.refs.canvas.height=this.refs.video.videoHeight,this.refs.canvas.style.aspectRatio=this.refs.video.videoWidth+" / "+this.refs.video.videoHeight,this.access.ctx.drawImage(this.refs.video,0,0,this.refs.video.videoWidth,this.refs.video.videoHeight,0,0,this.refs.canvas.width,this.refs.canvas.height))}clear(){this.access.ctx.clearRect(0,0,this.refs.canvas.width,this.refs.canvas.height)}async fullClick(){if(e.dom.is.full){if(await e.dom.exitFullscreen(),!this.access.instance)return;return await e.tool.sleep(150),void(this.props.fsrc&&(this.capture(),this.access.instance?.destroy(),this.access.instance=void 0,this.toPlay()))}await this.element.requestFullscreen(),this.access.instance&&(await e.tool.sleep(150),this.props.fsrc&&this.props.fsrc!==this.props.src&&(this.capture(),this.access.instance?.destroy(),this.access.instance=void 0,this.toPlay()))}get isFull(){return e.dom.is.full}onDown(s){this.propBoolean("controls")&&e.modules.pointer.hover(s,{enter:()=>{this.isShow=!0,this.hideTimer&&(e.task.removeTimer(this,this.hideTimer),this.hideTimer=0)},leave:()=>{this.hideTimer=e.task.sleep(this,()=>{this.isShow=!1},800)}})}onCanplay(){this.playData=this.propBoolean("play"),this.playData&&this.access.instance&&this.access.instance.play(),this.emit("canplay")}_waitingTimer=0;onPlaying(){this.clear(),this._waitingTimer&&(e.task.removeTimer(this,this._waitingTimer),this._waitingTimer=0)}onPause(){this._waitingTimer&&e.task.removeTimer(this,this._waitingTimer),this._waitingTimer=e.task.createTimer(this,()=>{this._waitingTimer=0,this.access.instance&&(this.capture(),this.access.instance?.destroy(),this.access.instance=void 0,this.toPlay())},5e3,{count:1})}onWaiting(){this._waitingTimer&&e.task.removeTimer(this,this._waitingTimer),this._waitingTimer=e.task.createTimer(this,()=>{this._waitingTimer=0,this.access.instance&&(this.capture(),this.access.instance.destroy(),this.access.instance=void 0,this.toPlay())},5e3,{count:1})}volumeClick(){if(this.volumeData)return this.refs.video.volume=0,this.volumeData=0,void this.emit("update:volume",0);this.refs.video.volume=this.volumeSave/100,this.volumeData=this.volumeSave,this.emit("update:volume",this.volumeData)}onError(s,t,e){this.access.mpegts&&(console.log("[ERROR][CONTROL][MPEGTS]","ERROR",s,t,e),this.capture(),this.access.instance?.destroy(),this.access.instance=void 0,this.toPlay())}async onMounted(){const s=await e.core.getModule("mpegts");if(!s)return this.isLoading=!1,void(this.notInit=!0);this.access.mpegts=s,this.access.ctx=this.refs.canvas.getContext("2d"),this.watch("volume",()=>{this.volumeData!==this.propInt("volume")&&(this.refs.video.volume=this.propInt("volume")/100,this.volumeData=this.propInt("volume"),this.propInt("volume")&&(this.volumeSave=this.propInt("volume")))},{immediate:!0}),this.watch("controls",()=>{this.propBoolean("controls")?(this.isShow=!0,this.hideTimer=e.task.sleep(this,()=>{this.isShow=!1},800)):this.hideTimer&&(e.task.removeTimer(this,this.hideTimer),this.hideTimer=0)},{immediate:!0}),this.watch("play",()=>{this.playData!==this.propBoolean("play")&&(this.playData=this.propBoolean("play"),this.playData?this.toPlay():(this.capture(),this.access.instance?.destroy(),this.access.instance=void 0))}),this.playData=this.propBoolean("play"),this.watch("src",(s,t)=>{if(s!==t){if(!this.props.src){if(!this.access.instance)return;return this.access.instance.destroy(),void(this.access.instance=void 0)}this.access.instance&&(this.access.instance.destroy(),this.access.instance=void 0),this.playData&&this.toPlay()}},{immediate:!0}),this.watch("reset",()=>{if(!this.propInt("reset")){if(!this._resetTimer)return;return e.task.removeTimer(this,this._resetTimer),void(this._resetTimer=0)}this._resetTimer&&e.task.removeTimer(this,this._resetTimer),this._resetTimer=e.task.createTimer(this,()=>{this.access.instance&&(this.capture(),this.access.instance.destroy(),this.access.instance=void 0,this.toPlay())},this.propInt("reset"))},{immediate:!0}),this.volumeSave=this.propInt("volume"),this.volumeData=this.propInt("volume"),this.isLoading=!1,this.emit("init",{mpegts:this.access.mpegts,instance:this.access.instance})}onUnmounted(){this.hideTimer&&(e.task.removeTimer(this,this.hideTimer),this.hideTimer=0),this._waitingTimer&&(e.task.removeTimer(this,this._waitingTimer),this._waitingTimer=0),this._resetTimer&&(e.task.removeTimer(this,this._resetTimer),this._resetTimer=0),this.access.instance&&this.access.mpegts&&(this.access.instance.off(this.access.mpegts.Events.ERROR,this.onError),this.access.instance.destroy(),this.access.instance=void 0,this.access.mpegts=void 0)}}return i}(clickgo.modules.clickgo);