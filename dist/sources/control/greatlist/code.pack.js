var emodule=function(t){"use strict";function e(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(s){if("default"!==s){var i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:function(){return t[s]}})}}),e.default=t,Object.freeze(e)}var s=e(t);class i extends s.control.AbstractControl{get filename(){return"/code.js"}constructor(){super(...arguments),this.emits={remove:null,add:null,change:null,changed:null,itemclicked:null,itemdblclicked:null,beforeselect:null,select:null,afterselect:null,clientwidth:null,client:null,gesture:null,scrollheight:null,scrollwidth:null,"update:modelValue":null,"update:scrollLeft":null,"update:scrollTop":null},this.props={disabled:!1,must:!0,multi:!1,ctrl:!0,selection:!1,gesture:[],scroll:"auto",contentWidth:"fill",virtual:!1,plain:!1,mode:"default",map:{},data:[],sizes:{},modelValue:[],scrollLeft:0,scrollTop:0},this.table=null,this.cw=0,this.client=0,this.length=0,this.sw=0,this.sl=0,this.offset=0,this.valueData=[],this.shiftStart=0,this.selectValues=[],this.beforeSelectValues=[],this.isSelectStart=!1,this.scrollShow=!0,this.refreshOffsetCount=0,this._needCheckValue=0,this.lastGlno=0}get tableContentWidth(){if(!this.table)return 0;if(!this.table.split)return 0;let t=0;for(const e in this.table.widthMap)t+=this.table.widthMap[e];return t}get mapComp(){return{disabled:this.props.map.disabled??"disabled",control:this.props.map.control??"control",unavailable:this.props.map.unavailable??"unavailable",leftline:this.props.map.leftline??"leftline"}}get leftlinecolor(){return t=>{if(t)return["primary","info","warning","danger"].includes(t)?"var(--"+("primary"===t?"success":t)+")":t}}get isSelected(){return t=>this.valueData.includes(t)}arrowUp(){if(this.valueData.length){if(0!==this.shiftStart)for(let t=this.shiftStart-1;t>=0;--t)if(this.props.data[t]&&!this.props.data[t][this.mapComp.disabled]&&!this.props.data[t][this.mapComp.unavailable]&&"split"!==this.props.data[t][this.mapComp.control]){this.select(t);break}}else this.select(this.shiftStart)}arrowDown(){if(this.valueData.length){if(this.shiftStart!==this.props.data.length-1)for(let t=this.shiftStart+1;t<this.props.data.length;++t)if(this.props.data[t]&&!this.props.data[t][this.mapComp.disabled]&&!this.props.data[t][this.mapComp.unavailable]&&"split"!==this.props.data[t][this.mapComp.control]){this.select(t);break}}else this.select(this.shiftStart)}refreshOffset(){const t=++this.refreshOffsetCount,e=(i=0)=>{if(t<this.refreshOffsetCount)return;if(i>3)return;if(!this.element.offsetParent||!this.client)return void s.task.sleep(this,()=>{e(i+1)},100);const a=this.refs.flow.getPos(this.shiftStart);a?a.start<this.offset?this.offset=a.start:a.end>this.offset+this.client&&(this.offset=a.end-this.client):s.task.sleep(this,()=>{e(i+1)},100)};e()}async checkValue(){if(!this.props.data.length)return;if(++this._needCheckValue,await this.nextTick(),this._needCheckValue>1)return void--this._needCheckValue;--this._needCheckValue;let t=!1;const e=this.getFirstNotDisabledIndex(),i=this.props.data.length-1,a=s.tool.clone(this.valueData);!this.propBoolean("multi")&&this.valueData.length>1&&(t=!0,this.valueData.splice(1),this.shiftStart=this.valueData[0]);for(let s=0;s<this.valueData.length;++s)(this.valueData[s]>i||this.props.data[this.valueData[s]]?.[this.mapComp.disabled]||"split"===this.props.data[this.valueData[s]]?.[this.mapComp.control])&&(t=!0,this.shiftStart===this.valueData[s]&&(this.shiftStart=s>0?this.valueData[0]??e:e,this.shiftStart<0&&(this.shiftStart=0)),this.valueData.splice(s,1),--s);if(this.propBoolean("must")&&0===this.valueData.length&&(t=!0,this.valueData=e<0?[]:[e],this.shiftStart=this.valueData.length?this.valueData[0]:0),t){if(this.propBoolean("multi")){const t=s.tool.compar(a,this.valueData);for(const e in t.remove){const s={go:!0,preventDefault:function(){this.go=!1},detail:{index:t.remove[e],value:parseInt(e)}};this.emit("remove",s)}for(const e in t.add){const s={go:!0,preventDefault:function(){this.go=!1},detail:{index:t.add[e],value:parseInt(e)}};this.emit("add",s)}}else{const t={go:!0,preventDefault:function(){this.go=!1},detail:{value:this.valueData}};this.emit("change",t);const e={detail:{value:this.valueData}};this.emit("changed",e)}this.emit("update:modelValue",this.valueData)}}onScrollHeight(t){this.length=t,this.emit("scrollheight",t)}onScrollWidth(t){this.sw=t,this.emit("scrollwidth",t)}select(t,e=!1,i=!1){let a=!1;if(t<-1&&(t=-1),this.propBoolean("must")&&-1===t)return;const l=t=>!(!this.props.data[t]||this.props.data[t][this.mapComp.disabled]||"split"===this.props.data[t][this.mapComp.control]);if(this.propBoolean("multi")&&(e||i))if(-1===t);else if(e){const e=[];if(t>this.shiftStart)for(let s=this.shiftStart;s<=t;++s)l(s)&&e.push(s);else for(let s=this.shiftStart;s>=t;--s)l(s)&&e.push(s);if(e.length!==this.valueData.length||!e.every(t=>this.valueData.includes(t))){const t=s.tool.compar(this.valueData,e);if(t.length.add)for(const e in t.add){const s={go:!0,preventDefault:function(){this.go=!1},detail:{index:t.add[e],value:parseInt(e)}};this.emit("add",s),s.go&&(a=!0)}if(t.length.remove)for(const e in t.remove){const s={go:!0,preventDefault:function(){this.go=!1},detail:{index:t.add[e],value:parseInt(e)}};this.emit("remove",s),s.go&&(a=!0)}a&&(this.valueData=e)}}else{const e=this.valueData.indexOf(t);if(e>-1){if(!this.propBoolean("must")||this.valueData.length>1)if(this.propBoolean("multi")){const s={go:!0,preventDefault:function(){this.go=!1},detail:{index:e,value:t}};this.emit("remove",s),s.go&&(a=!0,this.valueData.splice(e,1),this.shiftStart=t)}else a=!0,this.valueData.splice(e,1),this.shiftStart=t}else if(l(t))if(this.propBoolean("multi")){const e={go:!0,preventDefault:function(){this.go=!1},detail:{index:this.valueData.length,value:t}};this.emit("add",e),e.go&&(a=!0,this.shiftStart=t,this.valueData.push(t))}else a=!0,this.shiftStart=t,this.valueData=[t]}else if(-1===t){if(this.valueData.length>0)if(this.propBoolean("multi")){a=!0;for(let t=0;t<this.valueData.length;++t){const e={go:!0,preventDefault:function(){this.go=!1},detail:{index:t,value:this.valueData[t]}};this.emit("remove",e)}this.valueData=[]}else{const t={go:!0,preventDefault:function(){this.go=!1},detail:{value:[]}};if(this.emit("change",t),t.go){a=!0,this.valueData=[];const t={detail:{value:[]}};this.emit("changed",t)}}}else if(this.valueData.length>1||0===this.valueData.length){if(l(t))if(this.propBoolean("multi")){a=!0;const e=s.tool.clone(this.valueData);this.valueData=[t];const i=s.tool.compar(e,this.valueData);for(const t in i.remove){const e={go:!0,preventDefault:function(){this.go=!1},detail:{index:i.remove[t],value:parseInt(t)}};this.emit("remove",e)}for(const t in i.add){const e={go:!0,preventDefault:function(){this.go=!1},detail:{index:i.add[t],value:parseInt(t)}};this.emit("add",e)}this.shiftStart=t}else{const e={go:!0,preventDefault:function(){this.go=!1},detail:{value:[t]}};if(this.emit("change",e),e.go){a=!0,this.valueData=[t],this.shiftStart=t;const e={detail:{value:[t]}};this.emit("changed",e)}}}else if(this.valueData[0]!==t&&l(t))if(this.propBoolean("multi")){a=!0;const e=s.tool.clone(this.valueData);this.valueData[0]=t;const i=s.tool.compar(e,this.valueData);for(const t in i.remove){const e={go:!0,preventDefault:function(){this.go=!1},detail:{index:i.remove[t],value:parseInt(t)}};this.emit("remove",e)}for(const t in i.add){const e={go:!0,preventDefault:function(){this.go=!1},detail:{index:i.add[t],value:parseInt(t)}};this.emit("add",e)}this.shiftStart=t}else{const e={go:!0,preventDefault:function(){this.go=!1},detail:{value:[t]}};if(this.emit("change",e),e.go){a=!0,this.valueData[0]=t,this.shiftStart=t;const e={detail:{value:[t]}};this.emit("changed",e)}}a&&this.emit("update:modelValue",this.valueData)}arrowDownClick(t,e){s.dom.bindClick(t,()=>{const i=s.dom.hasTouchButMouse(t);this.select(e,t.shiftKey,!(this.propBoolean("ctrl")&&!i||!this.propBoolean("multi"))||t.ctrlKey);const a=t.target;void 0===a.dataset.cgPopOpen?s.form.showPop(a,this.refs.itempop,t):s.form.hidePop(a);const l={detail:{event:t,value:e,arrow:!0}};this.emit("itemclicked",l);const h={detail:{event:t,value:e,arrow:!0}};this.emit("itemdblclicked",h)})}innerDown(t,e){const i=t.target;void 0===i.dataset.cgGlno?s.dom.findParentByData(i,"cg-glno")?this.lastGlno=Date.now():s.dom.bindClick(t,()=>{this.select(e,t.shiftKey,!(this.propBoolean("ctrl")&&!(t instanceof TouchEvent)||!this.propBoolean("multi"))||t.ctrlKey);const s={detail:{event:t,value:e,arrow:!1}};this.emit("itemclicked",s);const i={detail:{event:t,value:e,arrow:!1}};this.emit("itemdblclicked",i)}):this.lastGlno=Date.now()}down(t){if(!s.dom.hasTouchButMouse(t)){if(void 0!==this.refs.flow.$el.dataset.cgPopOpen&&s.form.hidePop(),!this.propBoolean("must")&&this.propBoolean("ctrl")&&!(t instanceof TouchEvent)){const e=s.dom.findParentByData(t.target,"cg-size");void 0!==t.target.dataset.cgSize||e||s.dom.bindClick(t,()=>{this.select(-1,t.shiftKey,t.ctrlKey)})}t instanceof TouchEvent&&s.dom.bindLong(t,()=>{s.form.showPop(this.refs.flow.$el,this.refs.pop,t)})}}itemTouch(t,e){s.dom.bindLong(t,()=>{this.isSelected(e)||this.select(e,t.shiftKey,!!this.propBoolean("multi")||t.ctrlKey)})}itemContext(t,e){s.dom.hasTouchButMouse(t)||this.isSelected(e)||this.select(e,t.shiftKey,t.ctrlKey)}context(t){s.dom.hasTouchButMouse(t)||s.form.showPop(this.refs.flow.$el,this.refs.pop,t)}keydown(t){"ArrowDown"!==t.key&&"ArrowUp"!==t.key||(t.preventDefault(),"ArrowUp"===t.key?this.arrowUp():this.arrowDown())}getFirstNotDisabledIndex(){let t=-1;for(let e=0;e<this.props.data.length;++e)if(!this.props.data[e][this.mapComp.disabled]&&"split"!==this.props.data[e][this.mapComp.control]){t=e;break}return t}onBeforeSelect(){this.isSelectStart=!0,this.selectValues=[],this.beforeSelectValues="number"!=typeof this.valueData?this.valueData:this.valueData>0?[this.valueData]:[],this.emit("beforeselect")}onSelect(t){if(this.propBoolean("multi"))if(t.shift||t.ctrl)if(t.empty){for(const t of this.selectValues)this.select(t,!1,!0);this.selectValues=[]}else if(t.shift){for(let e=t.start;e<=t.end;++e)this.selectValues.includes(e)||this.beforeSelectValues.includes(e)||(this.selectValues.push(e),this.select(e,!1,!0));for(let e=0;e<this.selectValues.length;++e)this.selectValues[e]>=t.start&&this.selectValues[e]<=t.end||(this.select(this.selectValues[e],!1,!0),this.selectValues.splice(e,1),--e)}else{for(let e=t.start;e<=t.end;++e)this.selectValues.includes(e)||(this.beforeSelectValues.includes(e),this.selectValues.push(e),this.select(e,!1,!0));for(let e=0;e<this.selectValues.length;++e)this.selectValues[e]>=t.start&&this.selectValues[e]<=t.end||(this.select(this.selectValues[e],!1,!0),this.selectValues.splice(e,1),--e)}else t.empty?this.select(-1):(this.shiftStart=t.start,this.select(t.end,!0));else t.empty||this.select(t.start,t.shift,t.ctrl);this.emit("select",t)}onAfterSelect(){this.isSelectStart=!1,this.emit("afterselect")}onMounted(){const t=this.parentByName("table");t&&(this.table=t),this.watch("must",()=>{if(this.propBoolean("must")&&0===this.valueData.length){if(this.props.data[this.shiftStart]&&!this.props.data[this.shiftStart][this.mapComp.disabled]&&"split"!==this.props.data[this.shiftStart][this.mapComp.control])this.valueData=[this.shiftStart];else{const t=this.getFirstNotDisabledIndex();this.valueData=t>-1?[t]:[],this.shiftStart=this.valueData.length?this.valueData[0]:0}const t={detail:{value:[this.valueData[0]]}};this.emit("changed",t),this.emit("update:modelValue",this.valueData)}}),this.watch("multi",()=>{!this.propBoolean("multi")&&this.valueData.length>1&&(this.valueData.splice(1),this.shiftStart=this.valueData[0],this.emit("update:modelValue",this.valueData))}),this.watch("shiftStart",()=>{Date.now()-this.lastGlno<=300||this.isSelectStart||this.refreshOffset()}),this.watch(()=>JSON.stringify(this.props.data),async()=>{await this.checkValue()},{deep:!0}),this.watch("sl",()=>{this.emit("update:scrollLeft",this.sl)}),this.watch("offset",()=>{this.emit("update:scrollTop",this.offset)}),this.watch("scrollLeft",()=>{const t=this.propNumber("scrollLeft");t!==this.sl&&(this.sl=t)}),this.watch("scrollTop",()=>{const t=this.propNumber("scrollTop");t!==this.offset&&(this.client=t)}),this.watch("modelValue",()=>{this.valueData.length===this.props.modelValue.length&&this.valueData.every(t=>this.props.modelValue.includes(t))||(this.valueData=this.props.modelValue,this.shiftStart=this.valueData[0]??0,this.checkValue().catch(()=>{}))}),this.valueData=this.props.modelValue,this.valueData[0]&&(this.shiftStart=this.valueData[0]),this.checkValue().catch(()=>{})}}return i}(clickgo.modules.clickgo);